<HTML>

<HEAD>

<!--  formamus.htm version 02 February 1998 

      INSTRUCTIONS FOR SUBMITTING: DO NOT USE HTML EDITORS!

      SEARCH THIS TEXT FOR THE STRING "Your_" 

      AND REPLACE WITH WHATEVER YOU WANT TO PUBLISH! 

      THANKS A LOT: this will allow automated retrieval -->

<TITLE>madmasu.htm: An Unorthodox Win95 TSR Crack</TITLE>

</HEAD>



<BODY BGCOLOR=#C0C0C0 TEXT=#001010 VLINK=#405040>

<TABLE CELLPADDING="1" CELLSPACING="2" BORDER="1" WIDTH= "100%  

HEIGHT=" 22">

<TR><td></td>

<td>

<!-- Choose  a TITLE probably wont be changed -->

<center><FONT SIZE="+2">Cracking using KERNEL32.DLL??</fonT><br>

        <FONT SIZE="+1">Amazing how things dont change!</fonT>

</center>

</td>



<td>

<!-- Choose  a PROJECT GIF, leave this if unsure -->

<center><a href="advanced.htm" tppabs="http://www.anticrack.de/fravia/advanced.htm"><IMG SRC="xtranio.gif" tppabs="http://www.anticrack.de/fravia/xtranio.gif" 

ALT="student" 

ALIGN=CENTER WIDTH=114 HEIGHT=43 BORDER=0 VSPACE=0 

HSPACE=0></a>

<br>

<font color=gray>Advanced</FonT>

</center></td></tr>

<tR>

<td bgcolor="#FFFFEA"><center>

<FONT COLOR="890000">

<!-- CHOOSE A DATE (will probably be changed) -->

04 March 1998

</FONT></center>

</td>

<td bgcolor="#FFFFEA"><center>by <font size=+3>

<!-- Choose A HANDLE (wont be changed) -->

madmax!

</fonT></center>

</td>

<td VALIGN="center" bgcolor="#FFFFEA">

<!--

<a href="hcu98_3.htm" tppabs="http://www.anticrack.de/fravia/hcu98_3.htm"><IMG SRC="hcu1.gif" tppabs="http://www.anticrack.de/fravia/hcu1.gif" ALT="+cracker" ALIGN=BOTTOM 

WIDTH=114 HEIGHT=43 BORDER=0 VSPACE=0 HSPACE=0></a>

-->

</td>

</tr>

<TR><td><center><a href="index.html" tppabs="http://www.anticrack.de/fravia/index.html"><IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" 

ALIGN="BOTTOM" 

BORDER="0" VSPACE="0" HSPACE="0" width="13" height="13"></a></center></td>

<TD BGCOLOR="898030"><center>Courtesy of Fravia's page of 

reverse engineering</center> 

</center></TD>

<td BGCOLOR="898030">

<center>

<!-- Your truly+ will edit only if really necessary -->

<pre> </prE></center></td>

</TR>

<!-- this is for the 

data.....fra_00xx....yymmdd....handle..beg+int...not ass... -->

<tr><td><font 

color="#C4C0CF">fra_00F0<bR>980304<br>madmax!<br>0010<br>AD<br>P4<br></fonT></td><td><i><center>

<!-- Your truly+ comments -->

Tsch tsch, madmax! Playing with kernel!<bR>And THAT is exactly what makes the difference 

between master crackers and beginners!<br>What does a real reverser do? He reverses, of 

course :-)<br>Now, see, we have this windows overbloated world we must all swim inside... 

huge, heavy, slow applicationosauriers, stupidly chewing routines on the code planes... and look! 

The great reverser hunters come! Approaching swift, from beneath the codetrees! 

Man, that's an unfair match for the dick overbloated windoze protectors!<br>The reversers are CLEVER! They use TOOLS! They use dos and unix knowledge, and sharp assembly 

knives... and so the stupid, almost brainless applicationosurus lays dead... reversed 

in a pool of bloody code... have a good meal! burp! 

</i></center></td>

<td></td>

</tr>

<TR><td></td>

<!-- Leonard Coehn's old song, because we are poets, not only crackers 

-->

<TD BGCOLOR="898030"><center></i><b>There is a crack, a crack in 

everything 

That's how the light gets in</b></center>

<!-- Leonard Coehn's old song, because we are poets, not only crackers 

-->

</center></TD><td></td>

</TR>

<TR>

<td VALIGN= "MIDDLE" bgcolor="#C6E7C6"><font color=blue><center>

Rating</FONT></FONT></center>

</TD>

<td VALIGN = "MIDDLE" bgcolor="#C6E7C6"><font color=blue><center>

<!-- CHOOSE A RATING (may be changed) -->

( )<B>Beginner</B> ( )<B>Intermediate</B> (X)<B>Advanced</B> 

(X)<B>Expert</B></FONT>

</center></td>

<td bgcolor="#C6E7C6"><font color=red>NO beginner</fonT></td>

</tr>

</table>

<!-- END HEAD  -->

<bR>

<!-- CORPUS  -->



<!-- CHOOSE A COMMENT (may be changed)  -->

This essay will be like <u>nothing</u> you've ever read.  This essay 

does get

a bit detailed and will lose those not intimately familiar with Win95/NT 

and

its inner guts.  It will show how a program that seems unpatchable can 

be, 

through our last resort =)

<hR>

<center>

   <FONT SIZE="+2">

<!-- CHOOSE A TITLE (wont probably be changed) -->

Cracking using KERNEL32.DLL??

   </FONT><BR>

   <FONT SIZE="+2">

<!-- CHOOSE A SUBTITLE (wont proabbly be changed) -->

Amazing how things don't change!

   </FONT><BR>

   <FONT COLOR="0B7FC1">

<!-- REPEAT YOUR CHOSEN HANDLE HERE -->Written by 

madmax!

   </FONT>

</center><br><br>



<!-- INTRO STARTS HERE -->

<TABLE CELLPADDING="1" CELLSPACING="2" BORDER="1" WIDTH= "100%"  

HEIGHT="22" >

<tr><td bgcolor="#C6E7C6"><center><font size=+2><font 

color=blue>Introduction</fonT>

</fonT></center></td></tr></table>

<pre>

Deep within the Internet lies a great game...Subspace, by VIE(Virgin)

Having gone retail just recently, it was a matter of time till the 

protection came...And it did, quite well I might add.  How do we fix

a program that has CRC checks on itself and the memory it resides

in (active checking)???

</prE>

<br>



<!-- TOOLS STARTS HERE -->

<TABLE CELLPADDING="1" CELLSPACING="2" BORDER="1" WIDTH= "100%"  

HEIGHT="22" >

<tr><td bgcolor="#C6E7C6"><center><font size=+2><font color=blue>Tools 

required</fonT>

</fonT></center></td></tr></table>

Winice 3.22<br>

Hiew 5.66<br>

W32Dasm 8.9 (Regged helps)<br>

API Knowledge (Win32.Hlp will do)<br>

<br><br>



<!-- TARGET URL STARTS HERE -->

<TABLE CELLPADDING="1" CELLSPACING="2" BORDER="1" WIDTH= "100%"  

HEIGHT="22" >

<tr><td bgcolor="#C6E7C6"><center><font size=+2><font 

color=blue>Target's URL/FTP</fonT>

</fonT></center></td></tr></table>

<!-- DON'T FORGET TO PASTE HERE THE URL/FTP OF YOUR TARGET(S) -->

Not available except in Demo =( You have to get 1.32 from Hybrid and get

Regged update from http://subspace.vie.com/

<br><br>



<!-- PROGRAM HISTORY STARTS HERE -->

<TABLE CELLPADDING="1" CELLSPACING="2" BORDER="1" WIDTH= "100%"  

HEIGHT="22" >

<tr><td bgcolor="#C6E7C6"><center><font size=+2><font color=blue>Program 

History</fonT>

</fonT></center></td></tr></table>

<!-- PASTE HERE YOUR TARGET'S HISTORY (if any) -->

First Protection Scheme

<br><br>



<!-- REAL ESSAY  STARTS HERE -->

<TABLE CELLPADDING="1" CELLSPACING="2" BORDER="1" WIDTH= "100%"  

HEIGHT="22" >

<tr><td bgcolor="#C6E7C6"><center><font size=+2><font 

color=blue>Essay</fonT></fonT>

</center></td></tr></table>

SubSpace, an online game has been around for a while now.  I always 

found it

hard to cheat in...I only did it for fun, not to ruin the game.  But now 

the 

retail version came out and has added a CD-Check....Woohoo! Time to 

crack the

ol' knuckles and sit down...



If you have the retail, you will notice nothing different about the game 

till

you go to play and a "Please insert CD..." msg flashes with a time 

limit...

This brought a smile to my face, but little did I know...So I jump in 

Winice

immediately and:



<br>BPX GetDriveTypeA   (Commonly used in Cd-Checks to find the 

CDROM)<br>

<br>It catches and I'm then in SubSpace code...The usual routine has the 

following pattern:

<br>

<br> Find CDROM drive letter 			(GetDriveTypeA)

<br> Get space free on CD     			(GetDiskSpaceFreeA)

<br> If zero, then CD OK

<br> Get Label of CD          			(GetVolumeInformationA)

<br> IF label == 'SUBSPACE', then CD OK

<br> Open 'INTRO.FLC' in CD Root Dir.           (CreateFileA)

<br> If exist, then CD OK

<br> Get filesize of INTRO.FLC			(GetFileSize?)

<br> Cmp filesize to certain #

<br> If equal, set a flag



<p>

I won't bother with source since most people reading this won't have 

access

to the target, thus it means nothing...The more interesting part, and 

the 

point of this essay, is how we get around the check...We could just 

patch it

with HIEW and go on, but a CRC check stops us...We patch the crc check, 

and

memory checksums get us...Hard to debug since Winice's breakpoints(0CCh) 

throw off the values...So what do we do??  Well, I looked into API 

Hooking

(Which IS NOT a prostitute with a Computer Science Degree =) and it didn't 

look promising...Then I get a flashback, thinking back to my AsmEdit 

essay..

TSR Crack!  But this isn't the good ol' DOS environment, there is not a

AX=25XX, INT 21h function for Winblows...So where would our point of 

attack be...Windows ITSELF!</p>

<p>

I got this idea while attempting to fix a nuker on my own that had 

spread 

on IRC...Messing with important Win95 files is dangerous, toying with 

the

kernel is just crazy...So we know SubSpace's first call in its 

protection

scheme is to GetDriveTypeA..This API returns a 2 for floppies, 3 for 

HDs, 

and a 5 for CDROM (Other values dont interest us)...So I get this idea 

that

we will essentially attack this protection like a FAKECD program 

would...We

would emulate the files needed on our HD somewhere while a TSR emulates 

a CD</p><p>

But were going to do this runtime...In Winice, type:<br>

U GetDriveTypeA

<br>You will see the assembly code for the API..write a portion of the 

code 

so we will find it on disk in kernel32.dll

(I can't give my example because there are too many kernel32.dll's out 

there)



But basically you have a short routine that does some weird compares and 

then

goes on to another API with a JMP.....Like this:

<pre>

:BFF777C4 57                      push edi

:BFF777C5 6A21                    push 00000021

:BFF777C7 2BD2                    sub edx, edx

:BFF777C9 68EFE2F9BF              push BFF9E2EF

:BFF777CE 64FF32                  push dword ptr fs:[edx]

:BFF777D1 648922                  mov dword ptr fs:[edx], esp

:BFF777D4 8B7C2414                mov edi, dword ptr [esp+14]

:BFF777D8 0BFF                    or edi, edi

:BFF777DA 7407                    je BFF777E3

:BFF777DC 2BC0                    sub eax, eax

:BFF777DE 8D48FF                  lea ecx, dword ptr [eax-01]

:BFF777E1 F2                      repnz

:BFF777E2 AE                      scasb



* Referenced by a Jump at Address:BFF777DA(C)

|

:BFF777E3 648F02                  pop dword ptr fs:[edx]

:BFF777E6 83C408                  add esp, 00000008

:BFF777E9 5F                      pop edi

:BFF777EA E9E5D4FFFF              jmp BFF74CD4

</prE>

So we have this small routine..Where do we put our code?!?

Well, lets set a BPX on that JE and see if it ever actually jumps...

So  BPX BFF777DA  and run through Explorer or something that trips the 

BPX.

You will see that nothing ever makes that damn JE jump! So we can assume

(mainly because MS wrote it =) that this routine has little worth..So 

lets 

modify and optimize it:

<p>

(This routine is first called by SubSpace for the drive C:)

<prE>

:BFF777C4 57                      xor  edx,edx      ; the only instr. kept

:BFF777C5 6A21                    mov  eax,[esp]    ; get calling routine

:BFF777C7 2BD2                    cmp  eax,413e6e   ; is it SS CD-Check?

:BFF777C9 68EFE2F9BF              jnz  BFF777EA     ; if not, continue API

:BFF777CE 64FF32                  mov  [esp+4],eax  ; save return address

:BFF777D1 648922                  pop  eax          ; inc ESP by 4

:BFF777D4 8B7C2414                mov  eax,5	    ; we are a CDROM!

:BFF777D8 0BFF                    ret

:BFF777DA 7407                    je BFF777E3       ; useless MS stuff 

:BFF777DC 2BC0                    sub eax, eax      ; HERE!

:BFF777DE 8D48FF                  lea ecx, dword ptr [eax-01]

:BFF777E1 F2                      repnz

:BFF777E2 AE                      scasb



* Referenced by a Jump at Address:BFF777DA(C)

|

:BFF777E3 648F02                  pop dword ptr fs:[edx]

:BFF777E6 83C408                  add esp, 00000008

:BFF777E9 5F                      pop edi

:BFF777EA E9E5D4FFFF              jmp BFF74CD4

</prE><p>

As you can see, we have intercepted this API quite brutally...We are 

checking

to see whether it was called by SubSpace everytime it runs...Simple 

enough!

Now that we have fooled it to think C: is a CDROM drive, we move on to 

the 

Disk space free check:

<p>

(The original is similar to above, but with more garbage...Which helps,

because this routine is a bit bigger...Heres the new and improved 

routine!)

<pre>

:BFF778C5 2BD2                    xor  edx,edx      ; All MS is good for?

:BFF778C7 68B8E2F9BF              mov  eax,[esp]    ; get calling address

:BFF778CC 64FF32                  cmp  eax,491E22   ; is it SubSpace?

:BFF778CF 648922                  jnz  BFF77900     ; if not, continue API

:BFF778D2 8B4C240C                add  esp,14h      ; Real API returns alot

:BFF778D6 E302                    mov  [esp],eax    ; return point

:BFF778D8 8A01                    mov  [esp+18],eax ; where spacefree is ret.

:BFF778DA 8B4C2410                ret               ; go back...

:BFF778DE E302                    jcxz BFF778EA     ; rest of MS stuff

:BFF778E0 8B01                    mov eax, dword ptr [ecx]

:BFF778E2 8B4C2414                mov ecx, dword ptr [esp+14]

:BFF778E6 E302                    jcxz BFF778EA

:BFF778E8 8B01                    mov eax, dword ptr [ecx]

:BFF778EA 8B4C2418                mov ecx, dword ptr [esp+18]

:BFF778EE E302                    jcxz BFF778F2

:BFF778F0 8B01                    mov eax, dword ptr [ecx]

:BFF778F2 8B4C241C                mov ecx, dword ptr [esp+1C]

:BFF778F6 E302                    jcxz BFF778FA

:BFF778F8 8B01                    mov eax, dword ptr [ecx]

:BFF778FA 648F02                  pop dword ptr fs:[edx]

:BFF778FD 83C404                  add esp, 00000004

:BFF77900 E954D5FFFF              jmp BFF74E59

</pre>

So, we intercepted this routine and forced it to return 0 for disk space

free, like a CDROM...Now the only part left is the label check and the 

file

check...<p>

So simply, we label our C: drive SUBSPACE, and with a little asm program 

I 

stewed up, we make a file that is 37,433,486...Apply these patches to 

the 

KERNEL32.DLL and reboot... Cross your fingers and it will not crash!

</p>

<br><br>



<!-- FINAL NOTES STARTS HERE -->

<TABLE CELLPADDING="1" CELLSPACING="2" BORDER="1" WIDTH= "100%"  

HEIGHT="22" >

<tr><td bgcolor="#C6E7C6"><center><font size=+2><font color=blue>Final 

Notes</fonT>

</fonT></center></td></tr></table>

<p>

This is indeed an interesting way of approaching a crack...I've never 

seen 

anyone use this method, probably because its so dangerous and has

compatibility problems...I wanted to spread the idea I found to others 

so 

they may consider this technique in the future...The main problem with 

using

KERNEL32.DLL is that MS has so many damn versions of it, its crazy to 

make 

a patch for em all...</p><p>



Amazing, no matter how far DOS goes away, its roots still follow us in 

cracking!  TSR cracking is kind of a hobby of mine =) It's different!

</p><p>

PS - If you play SubSpace alot, buy the game...It's like 30 bux or 

something.

     I did this because I wanted the challenge! =)

</p>





<!-- OB DUH STARTS HERE -->

<TABLE CELLPADDING="1" CELLSPACING="2" BORDER="1" WIDTH= "100%"  

HEIGHT="22" >

<tr><td bgcolor="#C6E7C6"><center><font size=+2><font color=blue>Oh 

Duh</fonT></fonT>

</center></td></tr></table>

 <center>

   <i>I wont even bother explaining you 

   that you should BUY this target program if you intend to use it for a 

longer 

   period than the allowed one. Should you want 

   to STEAL this software instead, you don't need to crack its 

protection 

   scheme at all: you'll 

   find it on most Warez sites, complete and already regged, 

farewell.</i>

</center>



<!-- WAY OUT STARTS HERE -->

<hr>

<center><i>You are deep inside fravia's page of reverse engineering,  

choose your way out:</i></center>

<br><center>

<!-- EITHER A NICE GIF LIKE THIS -->





<a href="advanced.htm" tppabs="http://www.anticrack.de/fravia/advanced.htm"><IMG SRC="xtranio.gif" tppabs="http://www.anticrack.de/fravia/xtranio.gif" 

ALT="projecT3" ALIGN=CENTER WIDTH=114 HEIGHT=43 BORDER=0 VSPACE=0 

HSPACE=0></a>

<br>

<font color=gray>Back to advanced cracking</FonT>

<br><bR>



<!-- OR JUST A LINK LIKE THIS -->



<!--

<IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 

BORDER=0 VSPACE=0 HSPACE=0><A HREF="project1.htm" tppabs="http://www.anticrack.de/fravia/project1.htm">Back to 

Your_chosen_project</A> 

<hr width=33%>

-->



<IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 

BORDER=0 VSPACE=0 HSPACE=0><A HREF="index.html" tppabs="http://www.anticrack.de/fravia/index.html">homepage</A>

<IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 

BORDER=0 VSPACE=0 HSPACE=0><A HREF="links.htm" tppabs="http://www.anticrack.de/fravia/links.htm">links</A> 

<IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 

BORDER=0 VSPACE=0 HSPACE=0><A HREF="searengi.htm" tppabs="http://www.anticrack.de/fravia/searengi.htm">search_forms</A>



<IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 

BORDER=0 VSPACE=0 HSPACE=0><A HREF="orc.htm" tppabs="http://www.anticrack.de/fravia/orc.htm">+ORC</A>

<IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 

BORDER=0 VSPACE=0 HSPACE=0><A HREF="student.htm" tppabs="http://www.anticrack.de/fravia/student.htm">students' essays</A>

<IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 

BORDER=0 VSPACE=0 HSPACE=0><A HREF="academy.htm" tppabs="http://www.anticrack.de/fravia/academy.htm">academy database</A>

<br>

<IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 

BORDER=0 VSPACE=0 HSPACE=0><A HREF="realicra.htm" tppabs="http://www.anticrack.de/fravia/realicra.htm">reality cracking</A>

<IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 

BORDER=0 VSPACE=0 HSPACE=0><A HREF="howtosea.htm" tppabs="http://www.anticrack.de/fravia/howtosea.htm">how to search</A>

<IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 

BORDER=0 VSPACE=0 HSPACE=0><A HREF="javascri.htm" tppabs="http://www.anticrack.de/fravia/javascri.htm">javascript wars</A>

<br>

<IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 

BORDER=0 VSPACE=0 HSPACE=0><A HREF="tools.htm" tppabs="http://www.anticrack.de/fravia/tools.htm">tools</A>

<IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 

BORDER=0 VSPACE=0 HSPACE=0><A HREF="noanon.htm" tppabs="http://www.anticrack.de/fravia/noanon.htm">anonymity academy</A> 

<IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 

BORDER=0 VSPACE=0 HSPACE=0><A HREF="cocktail.htm" tppabs="http://www.anticrack.de/fravia/cocktail.htm">cocktails</A>

<IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 

BORDER=0 VSPACE=0 HSPACE=0><A 

HREF="ideale.htm" tppabs="http://www.anticrack.de/fravia/ideale.htm">antismut CGI-scripts</A>



<IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 

BORDER=0 VSPACE=0 HSPACE=0><A HREF="info.htm" tppabs="http://www.anticrack.de/fravia/info.htm">mail_fravia+</A>

<br>

<IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 

BORDER=0 VSPACE=0 HSPACE=0><A HREF="legal.htm" tppabs="http://www.anticrack.de/fravia/legal.htm">Is reverse engineering 

legal?</A>

</CENTER>

<hr>

<!-- THAT'S ALL, THANKS A LOT this will allow automated retrieval -->

</BODY>

</HTML>



______________________________________________________

Get Your Private, Free Email at http://www.hotmail.com

