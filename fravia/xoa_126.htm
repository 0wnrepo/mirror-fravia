<HTML>

<HEAD>

<TITLE>marigbox.htm Opening Vbox</TITLE>

</HEAD>



<BODY bgcolor="#C0C0C0" text="#001010" vlink="#405040">

<CENTER>

<A href="timelock.htm" tppabs="http://www.anticrack.de/fravia/timelock.htm"><IMG src="timelock.gif" tppabs="http://www.anticrack.de/fravia/timelock.gif" alt="timelock"

align="center" border="0" width="114" height="43"></A><BR>

<FONT color="#808080">The Timelock project</FONT><BR>

<BR>

<BR><FONT size=+2>PreviewParadise R.I.P. (vboxed programs... bye bye!)<BR>by Xoanon</FONT><BR>15 June 1998

<BR><BR>

<I>Well, well, well... sieh mal Eine an: the return of a great 

cracker... and the demise of an improved timelock.dll protection. How long will we have to 

repeat it? C-O-M-M-E-R-C-I-A-L R-E-A-D-Y M-A-D-E P-R-O-T-E-C-T-I-O-N-S A-R-E U-S-E-L-E-S-S.<BR>

Learn how to protect (on these very pages for instance) and then PROTECT YOURSELF your programs 

with a couple of assembly routines. They will be eventually defeated, of course, but NEVER so 

quickly and easily as a commercial protection can invariably be... man-o-man: learn to READ behind the hypes and frills, 

and then you'll never believe again what the commercial protectionists  

advertise (or anybody else for that matter: to advertise <U>means</U> to lie :-)<BR>

On one point Xoanon is dead wrong: I love him a lot, and hope that he will indulge in less 

maggots, 

more women and more reversing!<BR>You will also notice that Xoanon is the mind behind the 'rolling' 

of the whole 'timelock' +HCU project... and if you had forgot it, just read <A HREF="xoanon.htm" tppabs="http://www.anticrack.de/fravia/xoanon.htm">TimeLOCK_DLL reverse engineering (TL32V20.DLL)</A>, 

written more than ONE YEAR ago (a whole "epoque" on the Web) yet still valid!</I>

<P><BR>





<HR>

<FONT size="5"><!-- CHOOSE A TITLE (wont probably be changed) --></FONT>



<P align="center"><FONT size="5">VBox (05/98 - 06/98)</FONT><BR>

<FONT size="5"><!-- CHOOSE A SUBTITLE (wont proabbly be changed) -->PreviewParadise R.I.P. </FONT><BR>

<FONT color="#0B7FC1"><!-- REPEAT YOUR CHOSEN HANDLE HERE -->Written by xOANON [UCF/CLASS] </FONT><BR>

<BR>

<!-- INTRO STARTS HERE --></P>



<TABLE border="1" width="760" height="22">

    <TR>

        <TD bgcolor="#C6E7C6"><FONT color="#0000FF" size="5">Introduction</FONT></TD>

    </TR>

</TABLE>

</CENTER>

<P><!-- PASTE HERE YOUR INTRODUCTION -->Heya ol' Fravia+! Long time i'm not on your pages :) It's time

to come back i think..... Don't bug me if i don't support +HCU

as often as it would deserve, but you know.... i'm one of the

&quot;crackers-for-the-masses&quot; you don't love so much :)

Well, it's a choice... i like people use my cracks, i like to be

known, etc... But it's another story.</P>



<P>Last week i found a program called &quot;Script Driven

Internet&quot; and it appeared as protected with VBox. I read the

essay last month by <A href="marigbox.htm" tppabs="http://www.anticrack.de/fravia/marigbox.htm">Marigold</A>

(very interesting indeed), so i took a look at it just to know

something more about this protection. </P>



<P>Marigold (amazing) technics is the virginity-restoration, i

present here a patching method instead.... much clear, much (not

so) easier and (i think) much useful coz it's goal is to produce

an universal cracked DLL which you can put in you \WINDOWS\SYSTEM

to crack *EVERY* Vboxed program.<BR>

<!-- TOOLS STARTS HERE --></P>



<TABLE border="1" width="100%" height="22">

    <TR>

        <TD bgcolor="#C6E7C6"><FONT color="#0000FF" size="5">Tools

        required</FONT></TD>

    </TR>

</TABLE>



<P>SoftIce <BR>

W32D/ASM <BR>

Your favourite HexEditor<BR>

Cigarettes (5)<BR>

A fan (very hot here)<BR>

Some good grunge music (Nirvana, Stone Temple Pilots, etc...)</P>



<P><!-- TOOLS STARTS HERE --></P>



<TABLE border="1" width="100%" height="22">

    <TR>

        <TD bgcolor="#C6E7C6"><FONT color="#0000FF" size="5">Target's

        URL/FTP </FONT></TD>

    </TR>

</TABLE>

<!-- DON'T FORGET TO PASTE HERE THE URL/FTP OF YOUR TARGET(S) -->

<P><A href="javascript:if(confirm('ftp://ftp.previewsoftware.com/VboxBuilder.exe  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='ftp://ftp.previewsoftware.com/VboxBuilder.exe'" tppabs="ftp://ftp.previewsoftware.com/VboxBuilder.exe">VBox

Builder</A> (a tool to add Vbox to your programs, very useful for

cracking purposes too.... eheheh :)</P>



<P><BR>

<!-- PROGRAM HISTORY STARTS HERE --></P>



<TABLE border="1" width="100%" height="22">

    <TR>

        <TD bgcolor="#C6E7C6"><FONT color="#0000FF" size="5">Program

        History</FONT></TD>

    </TR>

</TABLE>

<!-- PASTE HERE YOUR TARGET'S HISTORY (if any) -->

<P>TimeLock by PreviewSoft has long and glorious <A

href="timelock.htm" tppabs="http://www.anticrack.de/fravia/timelock.htm">history </A>(of its cracking). Vbox is

&quot;a new beginning&quot; of a kind. It's different from its

predecessors almost to the loss of the ancestorial resemblance.<BR>

<BR>

<!-- REAL ESSAY  STARTS HERE --></P>



<TABLE border="1" width="100%" height="22">

    <TR>

        <TD bgcolor="#C6E7C6"><FONT color="#0000FF" size="5">Essay</FONT></TD>

    </TR>

</TABLE>

<!-- PASTE HERE THE TEXT OF YOUR ESSAY     THIS IS OF COURSE THE MOST IMPORTANT PART     PLEASE CHECK THE MARGINS WHEN YOU ARE FINISHED!      SHOULD NOT BLAST NETSCAPE MARGINS OUT! HAVE A LOOK INSIDE     YOUR OWN 

BROWSER WHEN YOU HAVE FINISHED!  -->

<P>Here we are.... let's start. First of all, install the VBox

builder (you need to get a .prv file from their webserver, so

connect to the internet for this and fill the form needed). Then

choose a .EXE file to protect (you could choose also a .DLL or an

.OCX, but choose an .EXE coz it's better and easier for cracking

purposes) and wrap it with VBox using the builder (choose now the

Trial days protection).</P>



<P>Now the fun begins. As Marigold says, and as we easily can

see, VBox protections const of 3 dlls which are copied into your

\WINDOWS\SYSTEM directories. These DLLs are : <STRONG>vboxp403.dll

- vboxb403.dll - vboxt403.dll</STRONG>. All these dlls except the

first are packed, so we will focus our attention on <STRONG>vboxp403.dll</STRONG>.This

dll acts as a loader/unpacker for the others (among the other

things, again just look at marigold's essay for a complete

explanation), so i tought this: if i find the code which unpacks

the dll, right after the unpacking i can patch <STRONG>*from

inside of vboxp403.dll*</STRONG> the protection code which

resides in <STRONG>vboxt403.dll</STRONG> memoryspace .... and i

did :) Smart approach isn't it ? :) </P>



<P>Note: This kind of patching can be done much easily with a

memory patch (see <A href="stone1.htm" tppabs="http://www.anticrack.de/fravia/stone1.htm">Stone</A>'s

essay), but memorypatch always need a loader, or a TSR-like

program to load just before the target. In this way, we can

obtain (as i said) a clean and universal crack which only need to

be copied in place of the original DLL.</P>



<P>So, stop talking and go on with cracking now......</P>



<P>First of all, move your system clock ahead so the target

expires.</P>



<P>Now, you VBoxed your .EXE with Trial days protection, right?

so it will be vulnerable to BPX GETLOCALTIME from our beloved

SoftICE. You will land in this code (after PRET from the API

routine) inside <STRONG>vboxp403.dll. </STRONG>We will use the

space of this code later to add our memorypatching code.</P>



<P>------------------------------------------------------------------------------------------------------------------------------</P>



<P>:0500E720 81ECCC000000 sub esp, 000000CC<BR>

<A name="0500E726">:0500E726 </A>8D442410 lea eax, dword ptr

[esp+10] <STRONG>*we will add memorypatch code here later*</STRONG><BR>

:0500E72A 56 push esi<BR>

:0500E72B 50 push eax<BR>

<BR>

* Reference To: KERNEL32.GetLocalTime, Ord:00F5h<BR>

|<BR>

:0500E72C FF1544C50105 Call dword ptr [0501C544]<BR>

:0500E732 8D4C2404 lea ecx, dword ptr [esp+04]<BR>

:0500E736 51 push ecx<BR>

<BR>

* Reference To: KERNEL32.GetSystemTime, Ord:0135h<BR>

|<BR>

:0500E737 FF1540C50105 Call dword ptr [0501C540]<BR>

:0500E73D 668B4C240E mov cx, word ptr [esp+0E]<BR>

:0500E742 66390D32AC0105 cmp word ptr [0501AC32], cx<BR>

:0500E749 7540 jne 0500E78B<BR>

:0500E74B 668B44240C mov ax, word ptr [esp+0C]<BR>

:0500E750 66390530AC0105 cmp word ptr [0501AC30], ax<BR>

:0500E757 7532 jne 0500E78B<BR>

</P>



<P>(......... etc..... etc......... )</P>



<P>-----------------------------------------------------------------------------------------------------------------------------</P>



<P>Going ahead with tracing, you will find this code in <STRONG>vboxt403.dll</STRONG>

which checks if the target is expired or not :</P>



<P>:07005EFB F6451408 cmp eax, [ebp+10]<BR>

:07005EFE 7402 jz 7005F02 <STRONG>*NOP it*</STRONG></P>



<P>and</P>



<P>:7005FAA 3B45F0 cmp eax, [ebp+10]<BR>

:7005FAD 751A jnz 7005FC9 <STRONG>* change it to JMP 7005FC9 *</STRONG></P>



<P>Ok, now theoretically our patch is done.... VBox screen will

not appear anymore BUT: we just did it in memory, how to apply it

on the file if <STRONG>vboxt403.dll </STRONG>is packed?</P>



<P>Here comes a little Zen, as our +teacher says.... We know that

dll must be unpacked somewhere, so let's start hunting for the

unpacking routine setting a <STRONG>BPM 7005EFE W</STRONG>

(breakpoint on memory range on write). This means SoftICE will

popup just when this memoryspace is accessed for writing (which

is, in our case, the unpacking of <STRONG>vboxt403.dll</STRONG>).</P>



<P>Ok, so set this breakpoint and rerun. You will land in our

beloved <STRONG>vboxp403.dll</STRONG> here:</P>



<P>-----------------------------------------------------------------------------------------------------------------------------</P>



<P>:0500E856 8BD1 mov edx, ecx<BR>

:0500E858 83E203 and edx, 00000003<BR>

:0500E85B C1E902 shr ecx, 02<BR>

:0500E85E F3 repz<BR>

:0500E85F A5 movsd <STRONG>*this write the unpacked code to

DS:EDI*</STRONG><BR>

:0500E860 FF249568E80005 jmp dword ptr [4*edx+0500E868]<BR>

:0500E867 90 nop<BR>

</P>



<P>-----------------------------------------------------------------------------------------------------------------------------</P>



<P>As you will notice, this routine is executed many times, since

the unpacking is done at little steps. Anyway, we will focus our

attention just when <STRONG>EDI</STRONG> reach 07007000. Why?

well, simple: since we want to patch at DS:7005xxx, if EDI reach

07007000 it means the code we need is already unpacked and ready

for our &quot;rape&quot; :). </P>



<P>Now, problem #2 : we need space to do our memory patch. Easy,

look at <A href="#0500E726">here</A>.... this code is of no more

use, since the protection is killed. So we can use the

memoryspace of this datecheck code to implement our memorypatch.</P>



<P>First of all, we have to locate the call to this routine and

NOP it, since we want to use it for our purpose. Here it is:</P>



<P>:05002880 6A00 push 00000000<BR>

:05002882 E899BE0000 call 0500E720 <STRONG>* just NOP this and

the DLL will not call the datecheck anymore *</STRONG><BR>

:05002887 83C404 add esp, 00000004<BR>

:0500288A 50 push eax<BR>

</P>



<P>Now for the memorypatch. We have to jump to our routine right?

so we need to modify this code right after the <STRONG>vboxt403.dll</STRONG>

is unpacked in memory:</P>



<P>change </P>



<P>:0500E860 FF249568E80005 jmp dword ptr [4*edx+0500E868] </P>



<P>to</P>



<P>:0500E860 E9C1FEFFFF909090 jmp 500E726 <STRONG>*ok, now this

jump to the entrypoint of our routine*</STRONG></P>



<P>Here is the memorypatch routine:</P>



<P>-----------------------------------------------------------------------------------------------------------------------------</P>



<P>:0500E726 81FF00700007 cmp edi, 07007000 <STRONG>*check if the

code we need to patch is unpacked yet*</STRONG><BR>

:0500E72C 7519 jne 0500E747 <STRONG>*act normally if not*</STRONG><BR>

:0500E72E 66C787FEEEFFFF9090 mov word ptr [edi+FFFFEEFE], 9090 <STRONG>*patch

at EDI-1102 = 7005EFE*</STRONG><BR>

:0500E737 C687ADEFFFFFEB mov byte ptr [edi+FFFFEFAD], EB <STRONG>*patch

at EDI-1053 = 7005FA0*</STRONG><BR>

:0500E73E 66C787A5EEFFFF9090 mov word ptr [edi+FFFFEEA5], 9090 <STRONG>*patch

at EDI-115B = 7005EA5*</STRONG><BR>

<BR>

* Referenced by a (U)nconditional or (C)onditional Jump at

Address:<BR>

|:0500E72C(C)<BR>

|<BR>

:0500E747 FF249568E80005 jmp dword ptr [4*edx+0500E868] <STRONG>*this

is the normal jump executed after unpacking*</STRONG><BR>

:0500E74E 90 nop<BR>

:0500E74F 90 nop<BR>

</P>



<P>-----------------------------------------------------------------------------------------------------------------------------</P>



<P>You notice i've done another patch at 0500E73E . What's it

about? well, it patch this code</P>



<P>-----------------------------------------------------------------------------------------------------------------------------</P>



<P>:7005E9C F6451408 test byte ptr [ebp+14],08<BR>

:7005EA0 BE01000000 mov esi, 00000001<BR>

:7005EA5 745B jz 7005F02 <STRONG>*NOP it*</STRONG></P>



<P>-----------------------------------------------------------------------------------------------------------------------------</P>



<P>which bypass the &quot;number of executions&quot; check

(another option of VBox, try it with the builder).</P>



<P>Well.... that's all. VBox is totally dead now, thanks to

Marigold and your little xOANINO :) Go patch the <STRONG>vboxp403.dll</STRONG>

according to this essay, copy it to your \WINDOWS\SYSTEM

overwriting the original one and say &quot;CIAO CIAO&quot; to

WeiJuhn Li :)</P>



<P>Alla prossima amici... e speriamo che l'Italia vinca 'sti

mondiali.... anche se dopo la partita di ieri mi sembra

improbabile :(</P>



<P>&nbsp;</P>



<TABLE border="1" width="100%" height="22">

    <TR>

        <TD bgcolor="#C6E7C6"><FONT color="#0000FF" size="5">Final

        Notes</FONT></TD>

    </TR>

</TABLE>



<P>I hope you all liked this essay. As you see, commercial

ready-made protections are not so secure as they claim (look at <A

href="javascript:if(confirm('http://www.previewsoftware.com/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.previewsoftware.com/'" tppabs="http://www.previewsoftware.com/">http://www.previewsoftware.com</A>

and laugh.... they say even SoftICE creators can't crack VBox and

TimeLock, i can't believe it). There would be lot of ways to do a

very secure protection (like using a decent PE-crypter), but

maybe they think all of us +HCUkers are stupid.... bah :)</P>



<P>My greets fly out to: All UCF and CLASS members, Devil, Stone,

Miramax, Marquis, Random, SpaceOne, SaiBada, Goku, SoftPJ

(pleeeeeeeeeease improve your E-Zine) :)</P>



<P><BR>

<!-- OB DUH STARTS HERE --></P>



<TABLE border="1" width="100%" height="22">

    <TR>

        <TD bgcolor="#C6E7C6"><FONT color="#0000FF" size="5">Ob

        Duh</FONT></TD>

    </TR>

</TABLE>



<P align="center"><I>I wont even bother explaining you that you

should BUY this target program if you intend to use it for a

longer period than the allowed one. Should you want to STEAL this

software instead, you don't need to crack its prot ection scheme

at all: you'll find it on most Warez sites, complete and already

regged, farewell.<!-- WAY OUT STARTS HERE --></I></P>



<HR>



<P align="center"><I>You are deep inside fravia's page of reverse

engineering, choose your way out:</I><BR>

<!-- EITHER A NICE GIF LIKE THIS --><A href="timelock.htm" tppabs="http://www.anticrack.de/fravia/timelock.htm"><IMG src="timelock.gif" tppabs="http://www.anticrack.de/fravia/timelock.gif" alt="timelock"

align="center" border="0" width="114" height="43"></A><BR>

<FONT color="#808080">Back to the Timelock project</FONT><BR>

<BR>

<!-- OR JUST A LINK LIKE THIS

 --><!--<IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 BORDER=0 VSPACE=0 HSPACE=0><A HREF="project1.htm" tppabs="http://www.anticrack.de/fravia/project1.htm">Back to Your_chosen_project</A> <hr width=33%>--><IMG src="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" alt="red" width="13" height="13"><A

href="index.html" tppabs="http://www.anticrack.de/fravia/index.html">homepage</A><IMG src="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" alt="red"

width="13" height="13"><A href="links.htm" tppabs="http://www.anticrack.de/fravia/links.htm">links</A> <IMG

src="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" alt="red" width="13" height="13"><A

href="searengi.htm" tppabs="http://www.anticrack.de/fravia/searengi.htm">search_forms</A><IMG src="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif"

alt="red" width="13" height="13"><A href="orc.htm" tppabs="http://www.anticrack.de/fravia/orc.htm">+ORC</A><IMG

src="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" alt="red" width="13" height="13"><A

href="student.htm" tppabs="http://www.anticrack.de/fravia/student.htm">students' essays</A><IMG src="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif"

alt="red" width="13" height="13"><A href="academy.htm" tppabs="http://www.anticrack.de/fravia/academy.htm">academy

database</A><BR>

<IMG src="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" alt="red" width="13" height="13" hspac

e="0"><A href="realicra.htm" tppabs="http://www.anticrack.de/fravia/realicra.htm">reality cracking</A><IMG

src="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" alt="red" width="13" height="13"><A

href="howtosea.htm" tppabs="http://www.anticrack.de/fravia/howtosea.htm">how to search</A><IMG src="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif"

alt="red" width="13" height="13" vspa ce="0"><A

href="javascri.htm" tppabs="http://www.anticrack.de/fravia/javascri.htm">javascript wars</A><BR>

<IMG src="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" alt="red" width="13" height="13"><A

href="tools.htm" tppabs="http://www.anticrack.de/fravia/tools.htm">tools</A><IMG src="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" alt="red"

width="13" height="13" vs pace="0"><A href="noanon.htm" tppabs="http://www.anticrack.de/fravia/noanon.htm">anonymity

academy</A> <IMG src="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" alt="red" width="13"

height="13"><A href="cocktail.htm" tppabs="http://www.anticrack.de/fravia/cocktail.htm">cocktails</A><IMG

src="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" alt="red" width="13" height="13" borde r="0"><A

href="ideale.htm" tppabs="http://www.anticrack.de/fravia/ideale.htm">antismut CGI-scripts</A><IMG

src="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" alt="red" width="13" height="13"><A

href="info.htm" tppabs="http://www.anticrack.de/fravia/info.htm">mail_fravia+</A><BR>

<IMG src="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" alt="red" width="13" height="13" ttom><A

href="legal.htm" tppabs="http://www.anticrack.de/fravia/legal.htm">Is reverse engineering legal?</A></P>



<HR>

</BODY>

</HTML>

