<html>

<head>

<title>chown.htm: Who owns your files?

</title></head><body BGCOLOR="#C0C0C0" TEXT="#001010" VLINK="#405040">

<table CELLPADDING="1" CELLSPACING="2" BORDER="1" WIDTH="100%" HEIGHT="22">

<tr><td></td><td>

<!-- Choose  a TITLE and a subtitle, choose well! -->

<center><font SIZE="+2">

Who owns your files?

</font><br><font SIZE="+1">

Security thorough obscurity

</font></center></td><td>

<!-- Choose  a PROJECT GIF, leave this if unsure -->

<center><a href="noanon.htm" tppabs="http://www.anticrack.de/fravia/noanon.htm" alt="noanon.htm"><img SRC="anon1.gif" tppabs="http://www.anticrack.de/fravia/anon1.gif" alt="anon1.gif" ALT="noanon" ALIGN="BOTTOM" WIDTH="114" HEIGHT="43" BORDER="0" VSPACE="0" HSPACE="0"></a>

<br><font color="gray">Fravia's Anonymity Academy</font><br>

</center></td></tr><tr><td bgcolor="#FFFFEA"><center><font COLOR="890000">

<!-- CHOOSE A DATE (will probably be changed) -->

21 Jul 1999

</font></center></td><td bgcolor="#FFFFEA"><center>by <font size="+3">

<!-- CHOOSE A HANDLE , i.e. your pseudo (wont be changed) -->

[blue]

</font></center></td><td VALIGN="center" bgcolor="#FFFFEA">

<!--<a href="hcu98_3.htm" tppabs="http://www.anticrack.de/fravia/hcu98_3.htm"><IMG SRC="hcu1.gif" tppabs="http://www.anticrack.de/fravia/hcu1.gif" ALT="+cracker" ALIGN=BOTTOM WIDTH=114 HEIGHT=43 BORDER=0 VSPACE=0 HSPACE=0></a>-->

</td></tr><tr><td><center><a href="index.html" tppabs="http://www.anticrack.de/fravia/index.html"><img SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALIGN="BOTTOM" BORDER="0" VSPACE="0" HSPACE="0" WIDTH="13" HEIGHT="13"></a></center></td>

<td BGCOLOR="898030"><center>Courtesy of Fravia's page of 

reverse engineering</center> 

</center></td><td BGCOLOR="898030"></td></tr>

<!-- this is for the data.....fra_00xx....yymmdd....handle..beg+int...not ass... -->

<tr><td><font color="#C4C0CF">fra_00xx<br>982207<br>[blue]<br>0100<br>CO<br>PC<br></font></td><td><i><center>

NAME 

chown - change owner 

SYNOPSIS 

/usr/ucb/chown [ -fR ] owner[.group] filename ... 

DESCRIPTION 

chown changes the owner of the filenames to owner. The owner may be either a decimal user ID (UID ) or a login name found in the password file. An optional group may also be specified. The group may be either a decimal group ID (GID ) or a group name found in the GID file. 



Only the super-user can change owner, in order to simplify accounting procedures. 



OPTIONS 

-f 

Do not report errors. 

-R 

Recursively descend into directories setting the ownership 

of all files in each directory encountered. When symbolic 

links are encountered, their ownership is changed, but they 

are not traversed. <hr>So far so good... now read this beautiful 

essay by [blue] and then download this file <a href="javascript:if(confirm('http://129.105.116.5/fravia/chown.zip  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://129.105.116.5/fravia/chown.zip'" tppabs="http://129.105.116.5/fravia/chown.zip">chown.zip</a>... 

and up you go, you superuser you... :-)

</i></center></td><td></td></tr><tr><td></td>

<!-- Leonard Coehn's old song, because we are poets, not only crackers -->

<td BGCOLOR="898030"><center></i><b>There is a crack, a crack in everything 

That's how the light gets in</b></center>

<!-- Leonard Coehn's old song, because we are poets, not only crackers -->

</center></td><td></td></tr><tr><td VALIGN="MIDDLE" bgcolor="#C6E7C6"><font color="blue"><center>Rating</font></font></center>

</td><td VALIGN="MIDDLE" bgcolor="#C6E7C6"><font color="blue"><center>

<!-- CHOOSE A RATING (may be changed) -->

( )<b>Beginner</b> (x)<b>Intermediate</b> ( )<b>Advanced</b> ( )<b>Expert</b></font>

</center></td><td></td></tr></table>

<!-- END HEAD  --><br>

<!-- CORPUS  -->

<!-- CHOOSE A COMMENT (may be changed)  -->

<p>Yet another example of Micro$oft dirty tricks: security thorough obscurity. 

</p>

<hr><center><font SIZE="+2">

<!-- Repeat your TITLE  -->

Who owns your files? 

   </font><br>

   <font SIZE="+2">

<!-- Repeat your SUBTITLE -->

Security thorough obscurity

   </font><br><font COLOR="0B7FC1">

<!-- REPEAT YOUR CHOSEN HANDLE HERE -->Written by 

[blue]

</font></center><br><br>



<!-- INTRO STARTS HERE -->

<table CELLPADDING="1" CELLSPACING="2" BORDER="1" WIDTH="100%" HEIGHT="22">

<tr><td bgcolor="#C6E7C6"><center><font size="+2"><font color="blue">Introduction</font>

</font></center></td></tr></table>

<p>The trick: made them think they are secure. Keep repeating this.

</p>

<!-- PASTE HERE YOUR INTRODUCTION -->





<!-- TOOLS STARTS HERE -->

<table CELLPADDING="1" CELLSPACING="2" BORDER="1" WIDTH="100%" HEIGHT="22">

<tr><td bgcolor="#C6E7C6"><center><font size="+2"><font color="blue">Tools required</font>

</font></center></td></tr></table>



<p>None really. Win32 development tools if you want to implement ideas from this essay.

</p>

<p>You should know about Windows NT administration, Windows NT security model, ACL, ACE, 

Win32 programming (sorry... no assembly required :-)

</p>

<p>A good book on NT administration is Windows NT 4 Server Unleashed by Jason Garms (you 

can find it on the Web).

</p>



<!-- PASTE HERE YOUR REQUIRED TOOLS -->





<!-- TARGET URL STARTS HERE -->

<table CELLPADDING="1" CELLSPACING="2" BORDER="1" WIDTH="100%" HEIGHT="22">

<tr><td bgcolor="#C6E7C6"><center><font size="+2"><font color="blue">Target's URL/FTP</font>

</font></center></td></tr></table>

<!-- DON'T FORGET TO PASTE HERE THE URL/FTP OF YOUR TARGET(S) -->



<p>www.microsoft.com/ntserver

</p>



<!-- PROGRAM HISTORY STARTS HERE -->

<table CELLPADDING="1" CELLSPACING="2" BORDER="1" WIDTH="100%" HEIGHT="22">

<tr><td bgcolor="#C6E7C6"><center><font size="+2"><font color="blue">Program History</font>

</font></center></td></tr></table>

<!-- PASTE HERE YOUR TARGET'S HISTORY (if any) -->

<p>Too long to put here...

</p>



<!-- REAL ESSAY  STARTS HERE -->

<table CELLPADDING="1" CELLSPACING="2" BORDER="1" WIDTH="100%" HEIGHT="22">

<tr><td bgcolor="#C6E7C6"><center><font size="+2"><font color="blue">Essay</font></font>

</center></td></tr></table>

<!-- PASTE HERE THE TEXT OF YOUR ESSAY     THIS IS OF COURSE THE MOST IMPORTANT PART     PLEASE CHECK THE MARGINS WHEN YOU ARE FINISHED!      SHOULD NOT BLAST OPERA'S MARGINS OUT! HAVE A LOOK INSIDE     YOUR OWN BROWSER WHEN YOU FINISH!  -->





<p>Since the first multi-user operating system arise the necessity for controlling the 

access to resources. This leads to another problem: the system administrator needs a

lot of rights to perform his daily duties (for example to do backups), but how we can

protect some files from being accessed by sysadm? A company can have a lot of sensitive 

information: payroll lists, customers lists, etc. How can we protect this kind of files 

from being accessed by sysadm without anyone noticing?

</p>



<p>In UNIX it's just not possible. The root account is omnipotent. When NT appears it claims

it solved this problem. Please read the following statements carefully.

</p>

<font color="blue">

<blockquote>

<p>An owner cannot change the ownership of a resource they own. The owner can only give 

another user or group permission to take ownership of a resource. Security of resource 

is thus maintained by preventing users from creating or editing files and then making 

them look as if they belonged to someone else.

</p>

<p>For example, if a user assign the No access permission to a file, a member of the 

Administrators group can still take ownership of the file and make changes to it. 

The user, by checking the ownership of the file, would see that the administrator owned 

the file, and had disregarded the No Access permission on the file.

</p>

<p><cite>Microsoft Education and Certification - Administering Microsoft Windows NT 4.0, 

page 133

</cite></p>

</blockquote>

</font>



<p>Good, very good.</p>



<blockquote>

<p>If an administrator wants to access a file that he or she is not granted access to, 

the administrator must first take ownership of that file. Once ownership is taken, the 

administrator will have full access to the file. It is important to note that 

administrator cannot give ownership back to the original owner. If this were so, 

the administrator could take ownership of a file, examine it, and then assign it back 

to the original owner without that owner's knowledge.

</p> 

<p>NOTE: Because administrators have backup privileges, an administrator could back up a 

file (or entire volume) and restore it onto another system. The administrator could then 

take ownership of a file on this new system, examine it, and then restore from backup 

with original permissions, without the owner's knowledge. Please keep this in mind when 

thinking about file security.

</p>

<p><cite>Knowledge Base Article Q102099 - Administrator Access to Files

</cite></p>

</blockquote>



<p>Friendly warning.</p>



<blockquote>

<p>The key distinction between C-level and B-level security is in the notion of access

control. In a C2 (DAC) system, owners have absolute discretion about whether or not 

others have access to their objects.

</p>

<p><cite>Knowledge Base Article Q93362 - C2 Evaluation and Certification for Windows NT

</cite></p>

</blockquote>



<p>Looks ok. The owner of a file should deny sysadm any access to file and that's it.

The only thing sysadm can do it's to take ownership of the file and then give himself

necessary rights, but this cannot go unnoticed: user can see the change of the file 

owner. Many people believe in those statements, and they give a feeling of security that

administrators cannot view users' files if the permissions are set properly.

However, it is simply <strong>not correct</strong>.



<p>There are two possibilities to change the owner of a file using Micro$oft tools.

</p>



<p><strong>Services for Macintosh:</strong>

</p>



<blockquote>

<ul>

<li><strong>Changing ownership changes the ACL.</strong> When you use the MacFile 

permission option to change the owner of a file, the old owner will be removed from the 

folder's access control list (ACL)-and likewise from all files within the folder. 

For example, if JGARMS is the owner and I change the owner to JSMITH, not only will 

the NTFS owner change to JSMITH, but JGARMS will be completely removed from the NTFS ACL.



<li><strong>The AFP permissions keep placeholder entries for the primary group and 

Everyone.</strong> If you use the MacFile Permissions option to remove all three AFP 

permissions from the primary group or the Everyone group, they still retain placeholder 

access control entries (ACEs) in the NTFS access control list.

<br>For instance, if you remove all the AFP permissions from the owner, the primary group, 

and Everyone, the resulting NTFS permissions on the folder will list the owner with 

special access (PO), and will list the primary group and Everyone with special 

access (), which is essentially no specified access.



<li><strong>You can set the owner of the folder to a group-it does not have to be an 

individual user's account.</strong> This is in sharp contrast to the normal operations 

of Windows NT, where the Administrators group is normally the only group that can own 

files. 

</ul>

<cite>Windows NT 4 Server Unleashed, Chapter 10, Jason Garms

</cite>



</blockquote>





<p>I take a look in Services for Macintosh documentation (including Microsoft Official

Curriculum materials): there is no mention of first side effect: changing 

Macintosh owner also changes NTFS owner. Of course you can figure it out but after all 

that noise about &quot;no possibility to SET owner&quot; they don't give even a fine print warning.

As you can see you have to dig, to search books to find what beast did you installed on 

your server.

</p>



<p><strong>POSIX Chown utility from Resource kit.</strong>

</p>



<p>This is a different beast: it does not run in Win32 subsystem. POSIX subsystem like 

Services for Macintosh has it's own rules.

</p>



<hr>



<p>How about writing normal Win32 program to change the owner of a file? It's also 

possible (I'll give you a hint shortly). With administrative privileges (Backup, Restore 

and Take Ownership) it is always possible to change the owner of a file (without 

destroying the Access Control List!), even if administrators have explicit No Access to 

the file. 

</p>





<p><strong>Win32 Security API</strong>

</p>



<p>The key function is <strong>SetFileSecurity</strong>:

</p>





<p>The <strong>SetFileSecurity</strong> function sets the security of a file or 

directory object.

</p>



<strong>BOOL SetFileSecurity(</strong>

<br>

<strong>&nbsp;&nbsp;LPCTSTR</strong>  <em>lpFileName</em>,	// address of string for filename 

<br>

<strong>&nbsp;&nbsp;SECURITY_INFORMATION</strong>  <em>SecurityInformation</em>,	// type of information to set

<br>

<strong>&nbsp;&nbsp;PSECURITY_DESCRIPTOR</strong>  <em>pSecurityDescriptor</em> 	// address of security descriptor 

<br>

);

<p><strong>Parameters</strong>

</p>



<dl>

<dt> <em>lpFileName</em>

<dd> Points to a null-terminated string specifying the file or directory for which 

security is set. 

<dt> <em>SecurityInformation</em>

<dd> Specifies a SECURITY_INFORMATION structure identifying the contents of the 

security descriptor pointed to by the pSecurityDescriptor parameter. 

<dt> <em>pSecurityDescriptor</em>

<dd> Points to a SECURITY_DESCRIPTOR structure. 

</dl>



<p><strong>Return Value</strong>



<p>If the function succeeds, the return value is TRUE.</p>



<p>If the function fails, the return value is FALSE. To get extended error information, 

call GetLastError.

</p>



<p><strong>Remarks</strong>

</p>



The <strong>SetFileSecurity</strong> function is successful only if the following 

conditions are met:

<ul>

<li>If the object's owner is being set, the calling process must have either WRITE_OWNER

permission or be the object's owner. 

<li>If the object's discretionary access-control list (ACL) is being set, the calling 

process must have either WRITE_DAC permission or be the object's owner. 

<li>If the object's system ACL is being set, the SE_SECURITY_NAME privilege must be 

enabled for the calling process. 

</ul>



<p>Things are clear now: we have to construct a valid security descriptor 

and apply it to file we want to modify.

</p>



<p>The details are left to the reader :-).

</p>



<p>Few starting points:

</p>



<ul>

<li> The SIDCLEAN example

<li> The Web: there are at least two programs available with source code

</ul>





<br><br>



<!-- FINAL NOTES STARTS HERE -->

<table CELLPADDING="1" CELLSPACING="2" BORDER="1" WIDTH="100%" HEIGHT="22">

<tr><td bgcolor="#C6E7C6"><center><font size="+2"><font color="blue">Final Notes</font>

</font></center></td></tr></table>



<p>Giving this we should question every Micro$oft affirmation. If they say we can't 

probably we can.

</p>

<!-- PASTE HERE YOUR FINAL NOTES (if any) -->







<!-- OB DUH STARTS HERE -->

<table CELLPADDING="1" CELLSPACING="2" BORDER="1" WIDTH="100%" HEIGHT="22">

<tr><td bgcolor="#C6E7C6"><center><font size="+2"><font color="blue">Ob Duh</font></font>

</center></td></tr></table><center><i>I wont even bother explaining you 

   that you should BUY this target program if you intend to use it for a 

   longer period than the allowed one. Should you want to STEAL this 

   software instead, you don't need to crack its protection scheme at all: 

   you'll find it on most Warez sites, complete and already regged, 

   farewell, don't come back.</i></center>



<!-- WAY OUT STARTS HERE -->

<hr><center><i>You are deep inside fravia's page of reverse engineering,  

choose your way out:<br><br></i>



<a href="corporat.htm" tppabs="http://www.anticrack.de/fravia/corporat.htm"><img SRC="anon1.gif" tppabs="http://www.anticrack.de/fravia/anon1.gif" alt="anon1.gif" ALT="noanon" ALIGN="BOTTOM" WIDTH="114" HEIGHT="43" BORDER="0" VSPACE="0" HSPACE="0"></a>

<br>

<font color="gray">Back to corporate survival</font>

<br><br>







<br><img SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN="BOTTOM" WIDTH="88%" HEIGHT="6" BORDER="0" VSPACE="0" HSPACE="0"><br>





<!-- Begin Javascript relocator <font color=gray><b>~</b></fonT> Javascript code by fravia+ -->

<form name="FraviasForm">

<script LANGUAGE="javascript">

<!--



function FravPage(list) {

	      location.href = list.options[list.selectedIndex].value

}



// -->

</script>

<div align="center">

<center>

<p center="&lt;center&gt;&lt;/center&gt;">&nbsp;<select name="fraviale" size="1">



<option>Choose another page!</option>

<option value="index.htm">Main page</option>

<option value="academy.htm">Software reversing Lab</option>

<option value="realicra.htm">Reality cracking Lab</option>

<option value="noanon.htm">Anonymity Lab</option>

<option value="ideale.htm">Site busting Lab</option>

<option value="howtosea.htm">How to search Lab</option>

<option value="sealight.htm">--Search engines (light)</option>

<option value="searengi.htm">--Search engines (heavy)</option>

<option value="links.htm">Links</option>

<option value="tools.htm">Tools</option>

<option value="javascri.htm">Javascript reversing</option>

<option value="screamin.htm">Screaming truth</option>

<option value="entran.htm">Main entrance</option>

<option value="new_what.htm">What's new on fravia's</option>

<option value="info.htm">Mail fravia+</option>

<option value="http://greythorne.home.ml.org">+Greythorne's</option>

<option value="http://www.InsideTheWeb.com/mbs.cgi/mb186724">Tools of our trade msgboard</option>

<option value="http://www.InsideTheWeb.com/mbs.cgi/mb155985">Main msgboard</option>

</select>



<input type="button" value="Let's go!" onclick="FravPage(this.form.elements[0])">

<br>

</div>



</form>

<!-- end Javascript relocator -->

<br><img SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN="BOTTOM" WIDTH="88%" HEIGHT="6" BORDER="0" VSPACE="0" HSPACE="0"><br><br>

<img SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN="BOTTOM" WIDTH="13" HEIGHT="13" BORDER="0" VSPACE="0" HSPACE="0"><a HREF="index.html" tppabs="http://www.anticrack.de/fravia/index.html">homepage </a><img SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN="BOTTOM" WIDTH="13" HEIGHT="13" BORDER="0" VSPACE="0" HSPACE="0">

<a HREF="links.htm" tppabs="http://www.anticrack.de/fravia/links.htm">links </a>

<img SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN="BOTTOM" WIDTH="13" HEIGHT="13" BORDER="0" VSPACE="0" HSPACE="0">

<a HREF="noanon.htm" tppabs="http://www.anticrack.de/fravia/noanon.htm">anonymity </a>

<img SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN="BOTTOM" WIDTH="13" HEIGHT="13" BORDER="0" VSPACE="0" HSPACE="0"><a HREF="orc.htm" tppabs="http://www.anticrack.de/fravia/orc.htm">+ORC </a>



<img SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN="BOTTOM" WIDTH="13" HEIGHT="13" BORDER="0" VSPACE="0" HSPACE="0"><a HREF="student.htm" tppabs="http://www.anticrack.de/fravia/student.htm">students' essays </a>



<img SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN="BOTTOM" WIDTH="13" HEIGHT="13" BORDER="0" VSPACE="0" HSPACE="0"><a HREF="academy.htm" tppabs="http://www.anticrack.de/fravia/academy.htm">academy database </a>



<img SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN="BOTTOM" WIDTH="13" HEIGHT="13" BORDER="0" VSPACE="0" HSPACE="0"><a HREF="botstart.htm" tppabs="http://www.anticrack.de/fravia/botstart.htm">bots wars</a>



<br>

<img SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN="BOTTOM" WIDTH="13" HEIGHT="13" BORDER="0" VSPACE="0" HSPACE="0"><a HREF="ideale.htm" tppabs="http://www.anticrack.de/fravia/ideale.htm">antismut </a>



<img SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN="BOTTOM" WIDTH="13" HEIGHT="13" BORDER="0" VSPACE="0" HSPACE="0"><a HREF="tools.htm" tppabs="http://www.anticrack.de/fravia/tools.htm">tools </a>



<img SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN="BOTTOM" WIDTH="13" HEIGHT="13" BORDER="0" VSPACE="0" HSPACE="0"><a HREF="cocktail.htm" tppabs="http://www.anticrack.de/fravia/cocktail.htm">cocktails </a>



<img SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN="BOTTOM" WIDTH="13" HEIGHT="13" BORDER="0" VSPACE="0" HSPACE="0"><a HREF="javascri.htm" tppabs="http://www.anticrack.de/fravia/javascri.htm">javascript wars </a>



<img SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN="BOTTOM" WIDTH="13" HEIGHT="13" BORDER="0" VSPACE="0" HSPACE="0"><a HREF="searengi.htm" tppabs="http://www.anticrack.de/fravia/searengi.htm">search_forms </a>



<img SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN="BOTTOM" WIDTH="13" HEIGHT="13" BORDER="0" VSPACE="0" HSPACE="0"><a HREF="info.htm" tppabs="http://www.anticrack.de/fravia/info.htm">mail_fravia </a><br>





<img SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN="BOTTOM" WIDTH="13" HEIGHT="13" BORDER="0" VSPACE="0" HSPACE="0"><a HREF="legal.htm" tppabs="http://www.anticrack.de/fravia/legal.htm">Is reverse engineering illegal?

</a></center>

</body>

</html>