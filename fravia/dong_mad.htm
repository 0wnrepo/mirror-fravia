<HTML>

<HEAD>

   <TITLE>Unplugging a dongle protection</TITLE>

   <META NAME="GENERATOR" CONTENT="Mozilla/3.04Gold (Win95; I) [Netscape]">

</HEAD>

<BODY TEXT="#001010" BGCOLOR="#C0C0C0" VLINK="#405040">



<TABLE BORDER=1 CELLSPACING=2 WIDTH="100%" HEIGHT="22" >



<TR>

<TD></TD>



<TD>

<CENTER><P><!-- Choose  a TITLE probably wont be changed --><B><FONT SIZE=+2>Unplugging

a dongle protection<BR>

</FONT></B><TT><FONT SIZE=+1>unplugging technical library<BR>

from Micro house</FONT></TT></P></CENTER>

</TD>



<TD>

<CENTER>

<A HREF="project3.htm" tppabs="http://www.anticrack.de/fravia/project3.htm"><IMG SRC="project3.gif" tppabs="http://www.anticrack.de/fravia/project3.gif" ALT="project3" BORDER=0 

HEIGHT=32 WIDTH=32 ALIGN=CENTER></A>

<BR>

Project 3</P></CENTER>

</TD>

</TR>



<TR>

<TD bgcolor="#FFFFEA">

<CENTER><!-- CHOOSE A DATE (will probably be changed) --><FONT COLOR="#890000">13 February 1998

</FONT></CENTER>

</TD>



<TD bgcolor="#FFFFEA">

<CENTER>by <!-- CHOOSE A HANDLE (wont be changed) --><FONT SIZE=+3>MaD

</FONT></CENTER>

</TD>



<TD VALIGN="center" bgcolor="#FFFFEA"></TD>

</TR>



<TR>

<TD>

<CENTER><P><A HREF="index.html" tppabs="http://www.anticrack.de/fravia/index.html"><IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" BORDER=0  ALIGN=BOTTOM width="13" height="13"></A></P></CENTER>

</TD>



<TD BGCOLOR="898030">

<CENTER><P>Courtesy of Fravia's page of reverse engineering </P></CENTER>

</TD>



<TD BGCOLOR="898030">

<CENTER><PRE> </PRE></CENTER>

</TD>

</TR>



<TR>

<TD><FONT COLOR="#C4C0CF">fra_00E6<BR>

981302<BR>

MAD<BR>

1100<BR>

P3<BR>

PC</FONT><BR>

</TD>



<TD>

<CENTER><P><!-- Your truly+ comments --><I>Great essay, dongle cracking takes 

another rithm!</I></P></CENTER>

</TD>



</TR>



<TR>

<TD></TD>







<TD BGCOLOR="898030">

<CENTER><P><B>There is a crack, a crack in everything That's how the light

gets in</B> <!-- Leonard Coehn's old song, because we are poets, not only crackers --></P></CENTER>

</TD>



<TD></TD>

</TR>



<TR>

<TD VALIGN= "MIDDLE" bgcolor="#C6E7C6">

<CENTER><FONT COLOR="#0000FF">Rating</FONT> </CENTER>

</TD>



<TD VALIGN = "MIDDLE" bgcolor="#C6E7C6">

<CENTER><!-- CHOOSE A RATING (may be changed) --><FONT COLOR="#0000FF">(x)<B>Beginner</B>

(x)<B>Intermediate</B> ( )<B>Advanced</B> ( )<B>Expert</B></FONT> </CENTER>

</TD>



<TD></TD>

</TR>

</TABLE>



<P><!-- END HEAD  --><BR>

<!-- CORPUS  --><!-- CHOOSE A COMMENT (may be changed)  -->This is another

undongling ... And again the software side is the weak partner here !!!!!



<HR><!-- CHOOSE A TITLE (wont probably be changed) --><B><FONT SIZE=+2>Unplugging

a dongle protection<BR>

<!-- CHOOSE A SUBTITLE (wont probably be changed) --></FONT></B><TT><FONT SIZE=+1>unplugging

technical library from Micro house<BR>

<!-- REPEAT YOUR CHOSEN HANDLE HERE --></FONT></TT><FONT COLOR="#0B7FC1">Written

by MaD [CPT]</FONT><BR>

<BR>

<!-- INTRO STARTS HERE --></P>



<TABLE BORDER=1 CELLSPACING=2 WIDTH="100%" HEIGHT="45" >

<TR>

<TD bgcolor="#C6E7C6">

<CENTER><P><FONT SIZE=+2><FONT COLOR="#0000FF">Introduction</FONT> </FONT></P></CENTER>

</TD>

</TR>

</TABLE>



<PRE>I read a few essays here at fravia's site about dongles. Two days ago I got an offer to

unprotect a dongle-protection. I didn't had to think twice ... This is not the only 

protection used in this target ... There's also a serial-entry dialog. I decided not to

implement this, because this is the dongle-project .... </PRE>



<PRE>The target today is a very expensive piece of software and very handy for people who

also like to play around with hardware but lost their manuals/ don't have manuals...

this program will provide you <B><I><TT>all</TT></I></B> the information you need .... jumpers,layout,specs.. (etc) 

of all PC-related products from <B><I><TT>all</TT></I></B> vendors (digital,compaq,adaptec.. clone-pc )</PRE>



<PRE>As we will go on in this essay we will see that a expensive protection (hardware keying)

will also flunk with a stupid piece of software handling it !!!!</PRE>



<P><BR>

<!-- TOOLS STARTS HERE --></P>



<TABLE BORDER=1 CELLSPACING=2 WIDTH="100%" HEIGHT="45" >

<TR>

<TD bgcolor="#C6E7C6">

<CENTER><P><FONT SIZE=+2><FONT COLOR="#0000FF">Tools required</FONT> </FONT></P></CENTER>

</TD>

</TR>

</TABLE>



<P>Well a usual <B>soft-ice 3.x</B> and<BR>

your own hex-editor , I like <B>ultra-edit 5.00a</B><BR>

<BR>

<!-- TARGET URL STARTS HERE --></P>



<TABLE BORDER=1 CELLSPACING=2 WIDTH="100%" HEIGHT="45" >

<TR>

<TD bgcolor="#C6E7C6">

<CENTER><P><FONT SIZE=+2><FONT COLOR="#0000FF">Target's URL/FTP</FONT>

</FONT></P></CENTER>

</TD>

</TR>

</TABLE>



<P><!-- DON'T FORGET TO PASTE HERE THE URL/FTP OF YOUR TARGET(S) -->Well

I guess a good store because this target is containing a install-floppy

and a data-cdrom which <BR>

explains why there is not a download-URL.... But I think you will get some

info from their site at www.mircohouse.com.<BR>

<BR>

<!-- PROGRAM HISTORY STARTS HERE --></P>



<TABLE BORDER=1 CELLSPACING=2 WIDTH="100%" HEIGHT="45" >

<TR>

<TD bgcolor="#C6E7C6">

<CENTER><P><FONT SIZE=+2><FONT COLOR="#0000FF">Program History</FONT> </FONT></P></CENTER>

</TD>

</TR>

</TABLE>



<P><!-- PASTE HERE YOUR TARGET'S HISTORY (if any) -->I don't know but I

saw a hand full of older releases going back to 1996 , sorry no real data<BR>

<BR>

<!-- REAL ESSAY  STARTS HERE --></P>



<TABLE BORDER=1 CELLSPACING=2 WIDTH="100%" HEIGHT="45" >

<TR>

<TD bgcolor="#C6E7C6">

<CENTER><P><FONT COLOR="#0000FF"><FONT SIZE=+2>Essay</FONT></FONT> </P></CENTER>

</TD>

</TR>

</TABLE>



<P><!-- PASTE HERE THE TEXT OF YOUR ESSAY



     THIS IS OF COURSE THE MOST IMPORTANT PART



     PLEASE CHECK THE MARGINS WHEN YOU ARE FINISHED! 



     SHOULD NOT BLAST NETSCAPE MARGINS OUT! HAVE A LOOK INSIDE



     YOUR OWN BROWSER WHEN YOU HAVE FINISHED!  --></P>



<PRE>Okay like I already said before , dongles are one of the most expensive protections but when

the software part of this alliance is weak .... bye bye money !!!!</PRE>



<PRE>When installing the software from the floppy the dongle is not checked yet (remember a serial

is needed to complete the setup, I didn't include this here because this about dongles

not about serial-checks). After clicking on the newly created shortcut we can see a nice

picture and a little window checking for the dongle .... </PRE>



<PRE>When run the program without the dongle it will return a dialog-window telling us it wants

to see dongle and waits for input (OK or cancel). If we run the program with the dongle and

we unplug the dongle while using the target it will start nagging for the dongle after

about 20sec (approx.).</PRE>



<PRE>Well after plugging the dongle back to the parallel-port, we'll set a break-point in soft-ice

<B>BPIO -H 378 R. </B>Run the program again and we crash inside the code at this point</PRE>



<UL>

<PRE>:0001.051D 83EA02                 sub dx, 0002

:0001.0520 58                     pop ax

:0001.0521 EC                     in al, dx           &lt;&lt;&lt;&lt; HERE

:0001.0522 A27800                 mov [0078], al

:0001.0525 B0FF                   mov al, FF

:0001.0527 EE                     out dx, al

:0001.0528 51                     push cx

:0001.0529 8B0E5D00               mov cx, [005D]

:0001.052D E2FE                   loop 052D

:0001.052F 59                     pop cx

:0001.0530 B0FF                   mov al, FF

:0001.0532 EE                     out dx, al

:0001.0533 EB00                   jmp 0535</PRE>

</UL>



<PRE>As we can see we are right in the IO part which is chatting with the dongle, note we have a

16-bit program. Before we have a closer look at this dongle-talk, I like to find the big call

who is executing this code. After pressing F12 (P RET) 3 times we'll get this <B>VERY </B>interesting

piece of code.</PRE>



<UL>

<PRE>:0002.0280 FF36C200               push word ptr [00C2]

:0002.0284 FF36C000               push word ptr [00C0]

:0002.0288 6A02                   push 0002

<I>:0002.028A 9AFFFF0000             call 0001.0164h

</I>:0002.028F 8BF0                   mov si, ax

:0002.0291 1E                     push ds

:0002.0292 68CE00                 push 00CE

:0002.0295 6A0C                   push 000C

<B>:0002.0297 9AFFFF0000             call 0001.0164h

</B>:0002.029C 8BF0                   mov si, ax               &lt;&lt;&lt;&lt; 'HERE' POINT OF ENTRY

:0002.029E 81FEEAE6               cmp si, E6EA

:0002.02A2 750A                   jne 02AE

:0002.02A4 C706BE000000           mov word ptr [00BE], 0000

:0002.02AA 33FF                   xor di, di

:0002.02AC EB13                   jmp 02C1</PRE>

</UL>



<PRE>'HERE' we can see a nice piece of code and which we will soon see is the weak part of the dongle

protection. The <B><I>call 0001.0164h </I></B>executes the dongle-chat code, the second one is the one we 

want, it returns a value in AX which is moved to SI and check with a absolute (read hard-wired)

value of 'E6EAh'. When 7the dongle plugged to the port it will return this value, when missing

it returns '0000' !!!! <B><I>SO THIS MEANS WE FOUND THE MAIN CHECK AND UNPROTECTED THE TARGET, THIS WE

DO BY COMPARING SI WITH 0000, OR NOPPING JNE 02AE AWAY </I></B>(I did it by cmp si with 0000)<B><I>.</I></B></PRE>



<PRE>(BTW. the first call at 0002.028a is probably a check on which LPT port the dongle is located

I didn't work that one out... I think it ain't so important...)</PRE>



<PRE>This is what I meant with the weakling in the alliance...... Note the zero-ing at 0002.02a4, 

remember that the dongle was check every '<B><I>XX</I></B>' secs this mem-loc. this is the flag for the 

periodly dongle check, set to '1' it will go to this piece of code and the dongle is checked

</PRE>



<UL>

<PRE>:0002.023B BF0100                 mov di, 0001

:0002.023E 833EBE0000             cmp word ptr [00BE], 0000   &lt;&lt;&lt;&lt; Check flag

:0002.0243 7405                   je 024A

:0002.0245 33C0                   xor ax, ax

:0002.0247 E98200                 jmp 02CC

:0002.024A C706BE000100           mov word ptr [00BE], 0001    &lt;&lt;&lt;&lt; SET CHECK-FLAG

</PRE>

</UL>



<PRE>So after this action the target knows that he needs to check the dongle again, <B><I>BUT </I></B>since

our target makes use of the same dongle_is_there-check (0002.029E) we don't need to worry

about that !!!!</PRE>



<PRE>Okay let's also have a quick look at that dongle_chat routine ....

It's a very long-treated routine, their for I didn't completely reverse it but I just pick a few 

high lights out of it (the important ones, in my opinion) and explained them. </PRE>



<PRE>I ran the program a few times and stepped thought the complete chat_to_dongle-routine a few 

times (NOT completing the loop (takes ages)). I found out that a series of digits were send to 

the parallel-port, dongle present or not (FF,FF,77,63,67,63,67,77). I think this is to activate

the hardware in the dongle. The same goes for ending a dongle-chat (00,FF,04,0C,0C)....</PRE>



<PRE>The data send and received from the dongle where related to a piece of data that looked like...</PRE>



<UL>

<UL>

<PRE>51.3A.4E.Lollapalooza</PRE>

</UL>

</UL>



<PRE>This was in memory as plain ASCII&nbsp;the hex look-a-like values were checked in the first call. </PRE>



<PRE>The <B>Lollapalooza</B> was used to manipulate the bits in DI. I couldn't find any piece of code in the

dead-listing which was using DI as offset.</PRE>



<UL>

<PRE>:0001.05BD 51                     push cx

:0001.05BE B90400                 mov cx, 0004

:0001.05C1 97                     xchg ax,di             &lt;&lt;&lt;&lt;&lt;

:0001.05C2 8AE0                   mov ah, al 

:0001.05C4 268A04                 mov al , es:[si]       &lt;&lt;&lt; get char of Lollapalooza

:0001.05C7 46                     inc si

:0001.05C8 D2C0                   rol al, cl 

:0001.05CA D3C8                   ror ax, cl 

:0001.05CC D3C8                   ror ax, cl 

:0001.05CE 97                     xchg ax,di             &lt;&lt;&lt;&lt;&lt;</PRE>

</UL>



<PRE>I found out that DI was used to determine if the manipulated value in DI was odd or even.</PRE>



<UL>

<PRE>:0001.0606 F7C70100               test di, 0001          &lt;&lt;&lt; test is value is odd or even

:0001.060A 7504                   jne 0610               &lt;&lt;&lt; odd then no changing BX



:0001.060C F6D8                   neg al

:0001.060E D1D3                   rcl bx, 01             &lt;&lt;&lt; change value bx rol carry</PRE>

</UL>



<P><BR>

The value BX is only changed if DI was even, so only at these times bx

is changed and at the last one BX will hold E6EA, <BR>

which is moved to AX just before leaving this complete CALL, which then

can be checked by E6EA</P>



<P>Okay end of transmission ..... maybe some other time or state .....</P>



<P><!-- FINAL NOTES STARTS HERE --></P>



<TABLE BORDER=1 CELLSPACING=2 WIDTH="100%" HEIGHT="45" >

<TR>

<TD bgcolor="#C6E7C6">

<CENTER><P><FONT SIZE=+2><FONT COLOR="#0000FF">Final Notes</FONT> </FONT></P></CENTER>

</TD>

</TR>

</TABLE>



<PRE>I think that the dongle-prinicple missed it's target in this protection scheme, or it's just

a stupid written piece of software. It could also be that I missed a few important facts

about this scheme because a stepped quickly throught it in order to write and support this 

essay.... </PRE>



<PRE>This may all be true , or held against me ... but still it's curious that at the end of this 

dongle-protection, a register is  checked with a 'hard-wired' value to protect the bits and

bytes  ... it's also curious that the same routine is used to initialize the software and  do

the periodly check during the up-time of the software ( I mean the same routine and the same

'physical mem-location' !!! and not a second different looking routine).</PRE>



<PRE>If you ask me, the dongle missed it's target and has the same effect as a serial check ..... 

(why not using the dongle to make jumps in memory !!!!)..</PRE>



<PRE>Today I had a quick (and unexpected) look at the latest version of this software, which seem to

be 'dongle-less' but now for every library you needed to key-in a serial ;).... I wonder why 

they let the dongle go ??? Did somebody else already made an essay ... ;o).... Or did they see 

the dongle missed target ???? We'll never know ...</PRE>



<PRE><!-- PASTE HERE YOUR FINAL NOTES (if any) -->



Have a nice day .... MaD [CPT]</PRE>



<P><BR>

<BR>

<!-- OB DUH STARTS HERE --></P>



<TABLE BORDER=1 CELLSPACING=2 WIDTH="100%" HEIGHT="45" >

<TR>

<TD bgcolor="#C6E7C6">

<CENTER><P><FONT COLOR="#0000FF"><FONT SIZE=+2>Ob Duh</FONT></FONT> </P></CENTER>

</TD>

</TR>

</TABLE>



<CENTER><P><I>I wont even bother explaining you that you should BUY this

target program if you intend to use it for a longer period than the allowed

one. Should you want to STEAL this software instead, you don't need to

crack its protection scheme at all: you'll find it on most Warez sites,

complete and already regged, farewell.</I> <!-- WAY OUT STARTS HERE -->

<HR><I>You are deep inside fravia's page of reverse engineering, choose

your way out:</I> <BR>

<!-- EITHER A NICE GIF LIKE THIS -->



<BR>

<A href="project3.htm" tppabs="http://www.anticrack.de/fravia/project3.htm"><IMG SRC="project3.gif" tppabs="http://www.anticrack.de/fravia/project3.gif" 

ALT="project3" ALIGN=CENTER WIDTH=114 HEIGHT=43 BORDER=0 VSPACE=0 

HSPACE=0></A>

<BR>

<FONT color=gray>Back to project 3</FONT>

<BR>

<BR>

<!-- OR JUST A LINK LIKE THIS -->



<IMG SRC="bulletr.gif" ALT="red" tppabs="http://www.anticrack.de/fravia/bulletr.gif" HEIGHT=13 WIDTH=13 ALIGN=BOTTOM><A HREF="index.html" tppabs="http://www.anticrack.de/fravia/index.html">homepage</A>

<IMG SRC="bulletr.gif" ALT="red" tppabs="http://www.anticrack.de/fravia/bulletr.gif" HEIGHT=13 WIDTH=13 ALIGN=BOTTOM><A HREF="links.htm" tppabs="http://www.anticrack.de/fravia/links.htm">links</A>

<IMG SRC="bulletr.gif" ALT="red" tppabs="http://www.anticrack.de/fravia/bulletr.gif" HEIGHT=13 WIDTH=13 ALIGN=BOTTOM><A HREF="searengi.htm" tppabs="http://www.anticrack.de/fravia/searengi.htm">search_forms</A>

<IMG SRC="bulletr.gif" ALT="red" tppabs="http://www.anticrack.de/fravia/bulletr.gif" HEIGHT=13 WIDTH=13 ALIGN=BOTTOM><A HREF="orc.htm" tppabs="http://www.anticrack.de/fravia/orc.htm">+ORC</A>

<IMG SRC="bulletr.gif" ALT="red" tppabs="http://www.anticrack.de/fravia/bulletr.gif" HEIGHT=13 WIDTH=13 ALIGN=BOTTOM><A HREF="student.htm" tppabs="http://www.anticrack.de/fravia/student.htm">students'

essays</A> <IMG SRC="bulletr.gif" ALT="red" tppabs="http://www.anticrack.de/fravia/bulletr.gif" HEIGHT=13 WIDTH=13 ALIGN=BOTTOM><A HREF="academy.htm" tppabs="http://www.anticrack.de/fravia/academy.htm">academy

database</A> <BR>

<IMG SRC="bulletr.gif" ALT="red" tppabs="http://www.anticrack.de/fravia/bulletr.gif" HEIGHT=13 WIDTH=13 ALIGN=BOTTOM><A HREF="realicra.htm" tppabs="http://www.anticrack.de/fravia/realicra.htm">reality

cracking</A> <IMG SRC="bulletr.gif" ALT="red" tppabs="http://www.anticrack.de/fravia/bulletr.gif" HEIGHT=13 WIDTH=13 ALIGN=BOTTOM><A HREF="howtosea.htm" tppabs="http://www.anticrack.de/fravia/howtosea.htm">how

to search</A> <IMG SRC="bulletr.gif" ALT="red" tppabs="http://www.anticrack.de/fravia/bulletr.gif" HEIGHT=13 WIDTH=13 ALIGN=BOTTOM><A HREF="javascri.htm" tppabs="http://www.anticrack.de/fravia/javascri.htm">javascript

wars</A> <BR>

<IMG SRC="bulletr.gif" ALT="red" tppabs="http://www.anticrack.de/fravia/bulletr.gif" HEIGHT=13 WIDTH=13 ALIGN=BOTTOM><A HREF="tools.htm" tppabs="http://www.anticrack.de/fravia/tools.htm">tools</A>

<IMG SRC="bulletr.gif" ALT="red" tppabs="http://www.anticrack.de/fravia/bulletr.gif" HEIGHT=13 WIDTH=13 ALIGN=BOTTOM><A HREF="noanon.htm" tppabs="http://www.anticrack.de/fravia/noanon.htm">anonymity

academy</A> <IMG SRC="bulletr.gif" ALT="red" tppabs="http://www.anticrack.de/fravia/bulletr.gif" HEIGHT=13 WIDTH=13 ALIGN=BOTTOM><A HREF="cocktail.htm" tppabs="http://www.anticrack.de/fravia/cocktail.htm">cocktails</A>

<IMG SRC="bulletr.gif" ALT="red" tppabs="http://www.anticrack.de/fravia/bulletr.gif" HEIGHT=13 WIDTH=13 ALIGN=BOTTOM><A HREF="javascript:if(confirm('http://www.fravia.org/ideale.htm  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.fravia.org/ideale.htm'" tppabs="http://www.fravia.org/ideale.htm">antismut

CGI-scripts</A> <IMG SRC="bulletr.gif" ALT="red" tppabs="http://www.anticrack.de/fravia/bulletr.gif" HEIGHT=13 WIDTH=13 ALIGN=BOTTOM><A HREF="info.htm" tppabs="http://www.anticrack.de/fravia/info.htm">mail_fravia+</A>

<BR>

<IMG SRC="bulletr.gif" ALT="red" tppabs="http://www.anticrack.de/fravia/bulletr.gif" HEIGHT=13 WIDTH=13 ALIGN=BOTTOM><A HREF="legal.htm" tppabs="http://www.anticrack.de/fravia/legal.htm">Is

reverse engineering legal?</A> 

<HR><!-- THAT'S ALL, THANKS A LOT this will allow automated retrieval --></P></CENTER>



</BODY>

</HTML>





