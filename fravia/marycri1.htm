<HTML><HEAD><!--  formamus.htm version 02 February 1998       INSTRUCTIONS FOR SUBMITTING: DO NOT USE HTML EDITORS!      SEARCH THIS TEXT FOR THE STRING "Your_"       AND REPLACE WITH WHATEVER YOU WANT TO PUBLISH!       THANKS A LOT: this will allow automated retrieval --><TITLE>marycri1.htm Instant removing of CrypKey (together with a lock)</TITLE></HEAD><BODY BGCOLOR=#C0C0C0 TEXT=#001010 VLINK=#405040><TABLE CELLPADDING="1" CELLSPACING="2" BORDER="1" WIDTH= "100%  HEIGHT=" 22"><TR><td></td><td><!-- Choose  a

 TITLE probably wont be changed --><center><FONT SIZE="+2">Instant removing of CrypKey (together with a lock)</fonT><br>        <FONT SIZE="+1">Unwrapping the wrapped</fonT></center></td><td><!-- Choose  a PROJECT GIF, leave this if unsure -->

<center><a href="progcor.htm" tppabs="http://www.anticrack.de/fravia/progcor.htm">

<IMG SRC="progcor.gif" tppabs="http://www.anticrack.de/fravia/progcor.gif" ALT="progcor" ALIGN=CENTER WIDTH=114 HEIGHT=43 BORDER=0 

VSPACE=0 HSPACE=0></a><br><font color=gray>Programmer's<bR>corner</FonT></center></td></tr><tR><td bgcolor="#FFFFEA"><center><FONT COLOR="890000"><!-- CHOOS

E A DATE (will probably be changed) -->7 May 1998</FONT></center></td><td bgcolor="#FFFFEA"><center>by <font size=+3><!-- CHOOSE A HANDLE (wont be changed) -->Marigold</fonT></center></td><td VALIGN="center" bgcolor="#FFFFEA"><!--<a href="hcu98_3.htm" tppabs="http://www.anticrack.de/fravia/hcu98_3.htm"><IMG 

SRC="hcu1.gif" tppabs="http://www.anticrack.de/fravia/hcu1.gif" ALT="+cracker" ALIGN=BOTTOM WIDTH=114 HEIGHT=43 BORDER=0 VSPACE=0 HSPACE=0></a>--></td></tr><TR><td><center><a href="index.html" tppabs="http://www.anticrack.de/fravia/index.html"><IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALIGN="BOTTOM" BORDER="0" VSPACE="0" HSPACE="0" width="13" height="13"></a></center></td><TD BGCOLOR="898030"><center>Courtesy of Fravia's page of reverse engineering</center> </center></TD><td BGCOLOR="898030"><center><!-- Your truly+ will edit only if really necessary -->slightly edited<br>by fravia+</center></td></TR><!-- this is for the data.....fra_00xx....yymmdd....handle..beg+int...not ass... --><tr><td><font color="#C4C0CF">fra_00xx<bR>98xxxx<br>handle<br>1100<br>NA<br>PC<br></fonT></td><td><i><center>

<!-- Your truly+ comments --><p>

<font color="c000c0">

"We believe that CrypKey is the best copy protection system available,

with an approximate 2 year technological lead on the nearest

competition. 

With our strong growth, world-wide acceptance and continual

enhancements, we believe that CrypKey will help keep YOU at the

forefront of technology if you choose to join our list of satisfied

customers, who include Motorola, Panasonic, SEGA, IBM, Sybase, and

Hewlett Packard to name a few."</font></p>Ah ah ah! Commercial assholes! Enjoy!</i></center></td><td></td></tr><TR><td></td><!-- Leonard Coehn's old song, because we are poets, not only crackers --><TD BGCOLOR="898030"><center></i><b>There is a crack, a crack in everything That's how the light gets in</b></center><!-- Leonard Coehn's old song, because we are poets, not only crackers --></center></TD><td></td></TR><TR><td VALIGN= "MIDDLE" bgcolor="#C6E7C6"><font color=blue><center>Rating</FONT></FONT></center></TD><td VALIGN = "MIDDLE" bgcolor="#C6E7C6"><font color=blue><center><!-- CHOOSE A RATING (may be changed) -->( )<B>Beginner</B> (x)<B>Intermediate</B> (x)<B>Advanced</B> ( )<B>Expert</B></FONT></center></td><td></td></tr></table><!-- END HEAD  --><bR><!-- CORPUS  --><!-- CHOOSE A COMMENT (may be changed)  -->Protection by "wrapping", "injection" and similar methods seems to be on rage nowadays.

Here is another example.<hR><center>   <FONT SIZE="+2"><!-- CHOOSE A TITLE (wont probably be changed) -->Instant removing of CrypKey (together with a lock)   </FONT><BR>   <FONT SIZE="+2"><!-- CHOOSE A SUBTITLE (wont proabbly be changed) -->Unwrapping the wrapped   </FONT><BR>   <FONT COLOR="0B7FC1"><!-- REPEAT YOUR CHOSEN HANDLE HERE -->Written by Marigold   </FONT></center><br><br><!-- INTRO STARTS HERE --><TABLE CELLPADDING="1" CELLSPACING="2" BORDER="1" WIDTH= "100%"  HEIGHT="22" ><tr><td bgcolor="#C6E7C6"><center><font size=+2><font color=blue>Introduction</fonT></fonT></center></td></tr></table>CrypKey protection (by Kenonic Controls Ltd) struck me as very cracker-friendly, especially in comparison with <a href="maribox.htm" tppabs="http://www.anticrack.de/fravia/maribox.htm">Vbox</a>. I would never bother to write about it, had I not received a piece of spam from the company. 

You only read 

this:<pre><font color="c000c0">"We believe that CrypKey is the best copy protection system available,

with an approximate 2 year technological lead on the nearest

competition. 

With our strong growth, world-wide acceptance and continual

enhancements, we believe that CrypKey will help keep YOU at the

forefront of technology if you choose to join our list of satisfied

customers, who include Motorola, Panasonic, SEGA, IBM, Sybase, and

Hewlett Packard to name a few."</font>

</pre>What a flagrant boasting! What ignorance! Hope, the crack I made will let some light into their heads (and into the heads of their satisfied customers... no wonder Motorola is there: sunset 

boulevard!).<br> 

BTW, "<i>2 year lead</I>" places them into year 2000 and makes an ideal target 

for <I>next millenium +crackers</I> :-)))<BR>

Our real target is <FONT color="RED">CrypKey Instant 4.3.1.</FONT> As with all similar protections, the protected proggy itself (the actual target of this reversing session) is irrelevant, so we'll take CrypKey Slot Machine, which is distributed as a protection demo.<BR>

Methods, with which protections of this kind are cracked, are quite standard in their own way. So, it is strongly recommended to read the relevant essays, for instance my own ones on <A href="marigo1.htm" tppabs="http://www.anticrack.de/fravia/marigo1.htm">TimeLock</A> and, maybe, <A href="maribox.htm" tppabs="http://www.anticrack.de/fravia/maribox.htm">Vbox</A>. I rely on reader's knowledge of 

PE-file structure and SoftDumping.



<BR><BR><!-- TOOLS STARTS HERE --><TABLE CELLPADDING="1" CELLSPACING="2" BORDER="1" WIDTH= "100%"  HEIGHT="22" ><TR><TD bgcolor="#C6E7C6"><CENTER><FONT size=+2><FONT color=blue>Tools required</FONT></FONT></CENTER></TD></TR></TABLE>

SoftIce - master debugger (everywhere on the Web)<BR>

<FONT color=red>+Quine</FONT>'s <A href="javascript:if(confirm('http://129.105.116.5/fravia/softdump.zip  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://129.105.116.5/fravia/softdump.zip'" tppabs="http://129.105.116.5/fravia/softdump.zip">SoftDump</A><BR>

Hiew566 - disassembler/hexeditor (everywhere on the Web)  <!-- PASTE HERE YOUR REQUIRED TOOLS --><BR><BR><!-- TARGET URL STARTS HERE --><TABLE CELLPADDING="1" CELLSPACING="2" BORDER="1" WIDTH= "100%"  HEIGHT="22" ><TR><TD bgcolor="#C6E7C6"><CENTER><FONT size=+2><FONT color=blue>Target's 

URL/FTP</FONT></FONT></CENTER></TD></TR></TABLE><!-- DON'T FORGET TO PASTE HERE THE URL/FTP OF YOUR TARGET(S) -->HTTP :<A href="javascript:if(confirm('http://www.crypkey.com/files/Slotz.exe  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.crypkey.com/files/Slotz.exe'" tppabs="http://www.crypkey.com/files/Slotz.exe">Slotz.exe</A><BR>

or<BR>

FTP :<A href="javascript:if(confirm('ftp://ftp.crypkey.com/pub/crypkey/Slotz.exe  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='ftp://ftp.crypkey.com/pub/crypkey/Slotz.exe'" tppabs="ftp://ftp.crypkey.com/pub/crypkey/Slotz.exe">Slotz.exe</A><BR><BR><!-- PROGRAM HISTORY STARTS HERE --><TABLE CELLPADDING="1" CELLSPACING="2" BORDER="1" WIDTH= "100%"  HEIGHT="22" ><TR><TD bgcolor="#C6E7C6"><CENTER><FONT size=+2><FONT color=blue>Program History</FONT></FONT></CENTER></TD></TR></TABLE><!-- PASTE HERE YOUR TARGET'S HISTORY (if any) -->Never heard before<BR><BR><!-- REAL ESSAY  STARTS HERE --><TABLE CELLPADDING="1" CELLSPACING="2" BORDER="1" WIDTH= "100%"  HEIGHT="22" ><TR><TD bgcolor="#C6E7C6"><CENTER><FONT size=+2><FONT color=blue>Essay</FONT></FONT></CENTER></TD></TR></TABLE><!-- PASTE HERE THE TEXT OF YOUR ESSAY     THIS IS OF COURSE THE MOST IMPORTANT PART     PLEASE CHECK THE MARGINS WHEN YOU ARE FINISHED!      SHOULD NOT BLAST NETSCAPE MARGINS OUT! HAVE A LOOK INSIDE     YOUR OWN BROWSER WHEN YOU HAVE FINISHED!  -->

<BR>

Disassembly of the target gives a strong <I>deja vu</I> feeling: again an obviously <I>extra </I> section CODE with the Entry Point in it; again some trouble with imported objects.<BR> Let's go to .idata section. Of course, it is mutilated. With close look 

one can see that the first 100h bytes are removed and some crap is placed in here. (With those PE-files one have to feel not only the <U>code</U>, but the <U>idata section</U>, as well! ;-)<BR> 

Well, it seems we have no choice but go to CODE section. <BR>

Never seen such a well-commented protection! For cracker not to miss the "hidden" chunk of .idata, his attention is attracted by a string "Resolve Imports". Almost immediately after it, at 41150, (all addresses are RVA) we have our 100h bytes! Of course, we

 are returning them to where they belong.<BR> 

Code itself begins with a loop that decrypts the next 0DCh bytes (XORing them with an openly stored mask). These bytes do the usual dirty work of license-checking, and let them do. We go to the following code:

<PRE>

0041FBD: 5B              pop    ebx ; = (4)41E53

0041FBE: 8BC3            mov    eax,ebx

0041FC0: 83EB04          sub    ebx,004

0041FC3: 8B0B            mov    ecx,[ebx]

0041FC5: 2BC1            sub    eax,ecx

0041FC7: FFE0            jmp    eax

</PRE>

For me it reads like: "Take a DWORD preceding the Entry Point and subtract it from the Entry Point address to get the real Entry Point." (41E53 - 387D3 = 9680) Do you see now why they inserted a string "EntryMarkHere" at 41E3E?<BR>

Having looked at the real Entry Point, we can instantly see that 1000(dec)=3E8h bytes here are encrypted. (We feel code +ORC's way, don't we?) Encryption is made by XORing with a pseudo-random mask, but we shouldn't bother about it: we're just waiting for the protection to decrypt code to dump then those 3E8 bytes with SoftDump to a file. (To patch them, of course, in place of encrypted crap).<BR><BR>

I hope, you already know what to do next:<BR>

<PRE>

1. Cut the CODE section off the file.

   In PE-header correct:

2. Number of Sections  |086: 06 -> 05

3. Entry Point         |0A8: 531E0400 -> 80960000

4. Image Size          |0D0: 00304000->00104000 (optionally for 95, but obligatory for NT!)

5. Erase the CODE section header</PRE>

<BR>

Cracking in the best traditions of "virginity restoration" is done.<BR>

<BR><HR>

Any trialware, which limits number of runs, has necessarly to 

mark in some way the computer to prevent "the license prolongation trick" 

by simple reinstallation. As Slots issues a license only for 2 runs, it may be of practical interest to prolong it (if you failed to crack it within the legitimate trial period). CrypKey Instant marks computers differently under Windows95 and NT.<BR> 

<B><U>Under NT </B></U>it all is simple enough. Additional <A href="javascript:if(confirm('http://www.crypkey.com/files/Ckntdvr.exe  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.crypkey.com/files/Ckntdvr.exe'" tppabs="http://www.crypkey.com/files/Ckntdvr.exe">NT driver </A>start the service "CrypKey License". License information is recorded in the file <B>esnecil.ind </B>("license" inverted, ah ah ah) in the system directory. This file cannot be deleted (which is our objection) or changed when the service is running (even if disabled). So, to renew your license you may:

<BR>1. Remove drivers with<PRE> setup_ck /D </PRE>command, delete the file and then reinstall drivers!

; or<BR>2. Load computer from a floppy in DOS mode and delete the file.<BR><BR><B><U>Under 95</B></U>, when your license is expired, the program scans all directories on disk C: and writes in some of them at random 4-byte-long strangely named files with content "00 00 00 7C" (in my case). At every start, the program scans 

directories in search for these files and, if at least one was found, displays message about license expiration and quits. Removing these files (I found about a dozen) improves the matter, but not decisively. Now program tells that it can't access id information on your HD, which obviously means that there is another mark somewhere. I had no patience to explore the problem to the bottom and solved it with a simple patch in <B>cryp9516.dll</B>. <BR>

<PRE>

<U>File 

offset</U>

007A56: FF76F4             push   w,[bp][-000C]

007A59: FF76F2             push   w,[bp][-000E]

007A5C: 9AD071BC71         call   001:071D0 

007A61: 83C404             add    sp,004<FONT color="BLUE">

007A64: 8946FC             mov    [bp][-0004],ax -> xor    ax,ax

007A67: 0BC0               or     ax,ax          -> mov    [bp][-0004],ax

007A69: 752B               jne   .0000171C6      -> or     ax,ax ; to avoid nop-ing </FONT>

007A6B: 837E0800           cmp    w,[bp][00008],000

007A6F: 7408               je    .0000171A9  

</PRE>

Now the license is renewed automatically when expired. 



<BR><BR><!-- FINAL NOTES STARTS HERE --><TABLE CELLPADDING="1" CELLSPACING="2" BORDER="1" WIDTH= "100%"  HEIGHT="22" ><TR><TD bgcolor="#C6E7C6"><CENTER><FONT size=+2><FONT color=blue>Final Notes</FONT></FONT></CENTER></TD></TR></TABLE>Targets, protected with CrypKey, may be regged with some license code. Some other approaches to cracking in this case may exist. But, IMHO, this kind of protection is specially conceived to be totally removed from target.<!-- PASTE HERE YOUR FINAL NOTES (if any) --><BR><BR><!-- 

OB DUH STARTS HERE --><TABLE CELLPADDING="1" CELLSPACING="2" BORDER="1" WIDTH= "100%"  HEIGHT="22" ><TR><TD bgcolor="#C6E7C6"><CENTER><FONT size=+2><FONT color=blue>Ob Duh</FONT></FONT></CENTER></TD></TR></TABLE> <CENTER>   <I>I wont even bother explaining 

you    that you should BUY this target program if you intend to use it for a longer    period than the allowed one. Should you want    to STEAL this software instead, you don't need to crack its protection    scheme at all: you'll    find it on most Warez sites, complete and already regged, farewell.</I></CENTER><!-- WAY OUT STARTS HERE --><HR><CENTER><I>You are deep inside fravia's page of reverse engineering,  choose your way out:</I></CENTER><BR><CENTER><!-- EITHER A NICE GIF LIKE THIS --><!-- <a href="project3.htm" tppabs="http://www.anticrack.de/fravia/project3.htm"><IMG SRC="project3.gif" tppabs="http://www.anticrack.de/fravia/project3.gif" ALT="projecT3" ALIGN=CENTER WIDTH=114 HEIGHT=43 BORDER=0 VSPACE=0 HSPACE=0></a><br><font color=gray>Back to project 3</FonT><br><bR>--><!-- OR JUST A LINK LIKE THIS --><!--<IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 BORDER=0 VSPACE=0 HSPACE=0><A HREF="project1.htm" tppabs="http://www.anticrack.de/fravia/project1.htm">Back to Your_chosen_project</A> <hr width=33%>--><IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 BORDER=0 VSPACE=0 HSPACE=0><A HREF="index.html" tppabs="http://www.anticrack.de/fravia/index.html">homepage</A><IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" 

ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 BORDER=0 VSPACE=0 HSPACE=0><A HREF="links.htm" tppabs="http://www.anticrack.de/fravia/links.htm">links</A> <IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 BORDER=0 VSPACE=0 HSPACE=0><A HREF="searengi.htm" tppabs="http://www.anticrack.de/fravia/searengi.htm">search_forms</A><IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 BORDER=0 VSPACE=0 HSPACE=0><A HREF="orc.htm" tppabs="http://www.anticrack.de/fravia/orc.htm">+ORC</A><IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 BORDER=0 VSPACE=0 HSPACE=0><A HREF="student.htm" tppabs="http://www.anticrack.de/fravia/student.htm">students' essays</A><IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 BORDER=0 VSPACE=0 HSPACE=0><A HREF="academy.htm" tppabs="http://www.anticrack.de/fravia/academy.htm">academy database</A><BR><IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 BORDER=0 VSPACE=0 HSPACE=0><A HREF="realicra.htm" tppabs="http://www.anticrack.de/fravia/realicra.htm">reality cracking</A><IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 BORDER=0 VSPACE=0 HSPACE=0><A HREF="howtosea.htm" tppabs="http://www.anticrack.de/fravia/howtosea.htm">how to search</A><IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 BORDER=0 VSPACE=0 HSPACE=0><A HREF="javascri.htm" tppabs="http://www.anticrack.de/fravia/javascri.htm">javascript wars</A><B!

r><IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 BORDER=0 VSPACE=0 HSPACE=0><A HREF="tools.htm" tppabs="http://www.anticrack.de/fravia/tools.htm">tools</A><IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 BORDER=0 VSPACE=0 HSPACE=0><A HREF="noanon.htm" tppabs="http://www.anticrack.de/fravia/noanon.htm">anonymity academy</A> <IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 BORDER=0 VSPACE=0 HSPACE=0><A HREF="cocktail.htm" tppabs="http://www.anticrack.de/fravia/cocktail.htm">cocktails</A><IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 BORDER=0 VSPACE=0 HSPACE=0><A HREF="ideale.htm" tppabs="http://www.anticrack.de/fravia/ideale.htm">antismut CGI-scripts</A><IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 BORDER=0 VSPACE=0 HSPACE=0><A HREF="info.htm" tppabs="http://www.anticrack.de/fravia/info.htm">mail_fravia+</A><BR><IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 BORDER=0 VSPACE=0 HSPACE=0><A HREF="legal.htm" tppabs="http://www.anticrack.de/fravia/legal.htm">Is reverse engineering legal?</A></CENTER><HR><!-- THAT'S ALL, THANKS A LOT this will allow automated retrieval --></BODY></HTML>

