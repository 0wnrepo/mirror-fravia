<HTML>

<HEAD>

<!--  formamus.htm version 02 February 1998 

      INSTRUCTIONS FOR SUBMITTING: DO NOT USE HTML EDITORS!

      SEARCH THIS TEXT FOR THE STRING "Your_" 

      AND REPLACE WITH WHATEVER YOU WANT TO PUBLISH! 

      THANKS A LOT: this will allow automated retrieval -->

<TITLE>mrf_steg.htm How to reverse engineer Steganos (First step)</TITLE>

</HEAD>



<BODY BGCOLOR=#C0C0C0 TEXT=#001010 VLINK=#405040>

<TABLE CELLPADDING="1" CELLSPACING="2" BORDER="1" HEIGHT="22" "100%">

<TR><TD></TD>

<TD>

<!-- Choose  a TITLE probably wont be changed -->

<CENTER><FONT SIZE="+2">How to reverse engineer Steganos (First

step)</FONT><BR>

        <FONT SIZE="+1">Speed up brute force cracking</FONT>

</CENTER>

</TD>



<TD>

<!-- Choose  a PROJECT GIF, leave this if unsure -->

<CENTER><A href="stego.htm" tppabs="http://www.anticrack.de/fravia/stego.htm"><IMG SRC="anon1.gif" tppabs="http://www.anticrack.de/fravia/anon1.gif" ALT="stego" 

ALIGN=CENTER WIDTH=114 HEIGHT=43 BORDER=0 VSPACE=0 

HSPACE=0></A>

<BR>

<FONT color=gray>Steganography</FONT>

</CENTER></TD></TR>

<TR>

<TD bgcolor="#FFFFEA"><CENTER>

<FONT COLOR="890000">

<!-- CHOOSE A DATE (will probably be changed) -->

11 February 1998

</FONT></CENTER>

</TD>

<TD bgcolor="#FFFFEA"><CENTER>by <FONT size=+3>

<!-- CHOOSE A HANDLE (wont be changed) -->

mrf

</FONT></CENTER>

</TD>

<TD VALIGN="center" bgcolor="#FFFFEA">

<!--

<a href="hcu98_3.htm" tppabs="http://www.anticrack.de/fravia/hcu98_3.htm"><IMG SRC="hcu1.gif" tppabs="http://www.anticrack.de/fravia/hcu1.gif" ALT="+cracker" ALIGN=BOTTO=

M 

WIDTH=114 HEIGHT=43 BORDER=0 VSPACE=0 HSPACE=0></a>

-->

</TD>

</TR>

<TR><TD><CENTER><A href="index.html" tppabs="http://www.anticrack.de/fravia/index.html"><IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" 

BORDER="0" VSPACE="0" HSPACE="0" width="13" height="13"></A></CENTER></TD>

<TD BGCOLOR="898030"><CENTER>Courtesy of Fravia's page of 

reverse engineering</CENTER> 

</CENTER></TD>

<TD BGCOLOR="898030">

<CENTER>

<PRE> </PRE></CENTER></TD>

</TR>

<!-- this is for the data.....fra_00xx....yymmdd....handle..beg+int...not=

 ass... -->

<TR><TD><FONT 

 color="#C4C0CF">fra_00XX<BR>980213<BR>mrf<BR>0100<BR>NA<BR>PC<BR></FON=

T></TD><TD><I><CENTER>

<!-- Your truly+ comments -->

Great! It's a first step, but in the CORRECT direction! We are finally beginning to get into Steganos' guts... now the big question 

is: will we go deeper inside Steganos' encryption routines immediately next or would 

it be (may be :-) 

more useful to examine a little the inner working of the OTHER applications from the stego page: S-tools, before delving inside 

Steganos? Any path you choose, this essay by mrf will help you a lot... Enjoy!

</I></CENTER></TD>

<TD></TD>

</TR>

<TR><TD></TD>

<!-- Leonard Coehn's old song, because we are poets, not only crackers -->

<TD BGCOLOR="898030"><CENTER></I><B>There is a crack, a crack in

everything 

That's how the light gets in</B></CENTER>

<!-- Leonard Coehn's old song, because we are poets, not only crackers -->

</CENTER></TD><TD></TD>

</TR>

<TR>

<TD VALIGN= "MIDDLE" bgcolor="#C6E7C6"><FONT color=blue><CENTER>

Rating</FONT></FONT></CENTER>

</TD>

<TD VALIGN = "MIDDLE" bgcolor="#C6E7C6"><FONT color=blue><CENTER>

<!-- CHOOSE A RATING (may be changed) -->

( )<B>Beginner</B> (x)<B>Intermediate</B> ( )<B>Advanced</B> (

)<B>Expert</B></FONT>

</CENTER></TD>

<TD></TD>

</TR>

</TABLE>

<!-- END HEAD  -->

<BR>

<!-- CORPUS  -->



<!-- CHOOSE A COMMENT (may be changed)  -->

This essay is quite easy to understand. It gives some basics about how to

reverse engineer

Steganos in general. If you know how to work with Wdasm89 and SoftIce,

you'll not have any 

problems to comprehend. It is recommended to know a little bit of Pascal,

though.

<HR>

<CENTER>

   <FONT SIZE="+2">

<!-- CHOOSE A TITLE (wont probably be changed) -->

How to reverse engineer Steganos (First Step)

   </FONT><BR>

   <FONT SIZE="+2">

<!-- CHOOSE A SUBTITLE (wont proabbly be changed) -->

Some basic ideas to speed up brute force cracking

   </FONT><BR>

   <FONT COLOR="0B7FC1">

<!-- REPEAT YOUR CHOSEN HANDLE HERE -->Written by 

mrf

   </FONT>

</CENTER><BR><BR>



<!-- INTRO STARTS HERE -->

<TABLE CELLPADDING="1" CELLSPACING="2" BORDER="1" HEIGHT="45" 

 WIDTH= "100%">

<TR><TD bgcolor="#C6E7C6"><CENTER><FONT size=+2><FONT 

 color=blue>Introduction</FONT>

</FONT></CENTER></TD></TR></TABLE>

<PRE>

Jean Flynn wrote a great essay about how he reached the advanced stego

page, but he didn't mention some details about Steganos that are very 

useful to know. 

The program calculates a checksum of the password. This'll be the target 

of my brute force attack.

 <!-- PASTE HERE YOUR INTRODUCTION -->

</PRE>

<BR><BR>



<!-- TOOLS STARTS HERE -->

<TABLE CELLPADDING="1" CELLSPACING="2" BORDER="1" HEIGHT="45" 

 WIDTH= "100%">

<TR><TD bgcolor="#C6E7C6"><CENTER><FONT size=+2><FONT color=blue>Tools

required</FONT>

</FONT></CENTER></TD></TR></TABLE>

W32Dasm<BR>

SoftIce<BR>

Steganos Decryptor 1.0 (Steganos itself should work, too)<BR>

Turbo Pascal (any version should do)<BR>

  <!-- PASTE HERE YOUR REQUIRED TOOLS -->

<BR><BR>



<!-- TARGET URL STARTS HERE -->

<TABLE CELLPADDING="1" CELLSPACING="2" BORDER="1" HEIGHT="45" 

 WIDTH= "100%">

<TR><TD bgcolor="#C6E7C6"><CENTER><FONT size=+2><FONT color=blue>Targe=

t's

URL/FTP</FONT>

</FONT></CENTER></TD></TR></TABLE>

<!-- DON'T FORGET TO PASTE HERE THE URL/FTP OF YOUR TARGET(S) -->

<A href="javascript:if(confirm('http://www.steganography.com/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.steganography.com/'" tppabs="http://www.steganography.com/">

http://www.steganography.com</A>

<BR><BR>



<!-- PROGRAM HISTORY STARTS HERE -->

<TABLE CELLPADDING="1" CELLSPACING="2" BORDER="1" HEIGHT="45" 

 WIDTH= "100%">

<TR><TD bgcolor="#C6E7C6"><CENTER><FONT size=+2><FONT color=blue>Progr=

am

History</FONT>

</FONT></CENTER></TD></TR></TABLE>

<!-- PASTE HERE YOUR TARGET'S HISTORY (if any) -->

<BR><BR>



<!-- REAL ESSAY  STARTS HERE -->

<TABLE CELLPADDING="1" CELLSPACING="2" BORDER="1" HEIGHT="45" 

 WIDTH= "100%">

<TR><TD bgcolor="#C6E7C6"><CENTER><FONT size=+2><FONT 

 color=blue>Essay</FONT></FONT>

</CENTER></TD></TR></TABLE>



<PRE>

You should read Jean Flinn's essay about how

he reached the advanced stego page. 

He explains the encryption routine itself, so i don't want to do this 

again. 

Finally, he used a dictionary derived from +Fravia's page. 

If we want to reverse engineer Steganos images in general, we'll 

not have the knowledge to build such a dictionary of probable words.

Thus, we have to think about a brute force attack.<BR>

I was not able to find a serious weakness in Steganos, as well, but i

found something that helps a little bit. Jean Flinn did not mention that 

Steganos calculates a checksum of the password, which is stored within 

the image. 

You should find the algorithm easily: Enter a password, bpx hmemcpy and

notice what's going on...

<BR>

<XMP>

:00407053 8A0439                  mov al, byte ptr [ecx+edi]	- store char in al

:00407056 8AD1                    mov dl, cl			- store counter in dl

:00407058 FEC2                    inc dl			- +1

:0040705A F6EA                    imul dl			- * al (char)

:0040705C 32D8                    xor bl, al			- xor checksum with al

:0040705E 41                      inc ecx			- inc counter

:0040705F 3BCE                    cmp ecx, esi			- finished ?

:00407061 7EF0                    jle 00407053			- no, do it again



:00407063 80FB2A                  cmp bl, 2A

:00407066 7502                    jne 0040706A

:00407068 B301                    mov bl, 01



:0040706A A1041B4400              mov eax, dword ptr [00441B04]

:0040706F 85C0                    test eax, eax

:00407071 7502                    jne 00407075

:00407073 B32A                    mov bl, 2A

	

:00407075 8D4C2410                lea ecx, dword ptr [esp+10]

:00407079 E8BED50100              call 0042463C

:0040707E 5F                      pop edi

:0040707F 8AC3                    mov al, bl

:00407081 5E                      pop esi

:00407082 5B                      pop ebx

:00407083 C3                      ret

 </XMP>

 This is the code translated into Pascal.

 <XMP>

  	function Checksum (passw: string): byte;

 	var i: integer;

 	    b: byte;

 	begin

 	 b:=0;

 	 for i:=1 to length (passw) do

 	  b:=b xor (ord(passw[i])*i);

 	 if b=42 then b:=1; 

 	 Checksum:=b;

 	end;

 </XMP>

 Steganos Decryptor compares the original checksum with the checksum of

the password at 402bf0.

 <XMP>

:00402A28 E813460000              call calcPasswdChksum (00407040)

:00402A2D 8A4C2418                mov cl, byte ptr [esp+18]

:00402A31 83C404                  add esp, 00000004

:00402A34 3AC1                    cmp al, cl

:00402A36 0F84A1000000            je 00402ADD

 </XMP>

 <BR>

 By setting a bpx 402a34, you'll find the original checksum in cl (8a for 

 <A href="javascript:if(confirm('http://129.105.116.5/fravia/t_tamra7.zip  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://129.105.116.5/fravia/t_tamra7.zip'" tppabs="http://129.105.116.5/fravia/t_tamra7.zip">+Fravia's image</A>). 

This is a good target for our attack, because it will sort out lots of 

wrong passwords. +Fravia told us that his password has 8 chars and i 

guessed that all of them were lower case (very probable for +Fravia's

passwords :-). 

Thus, I was able to sped up the algorithm a lot.

 

 <XMP>

  	 checksum:=0;

  	 for a:=1 to 26 do begin

	  chksum:=fe[a] xor chksum;

	  for b:=1 to 26 do begin

	   chksum:=(fe[b] shl 1) xor chksum;

	   for c:=1 to 26 do begin

	    chksum:=(fe[c]*3) xor chksum;

	    for d:=1 to 26 do begin

	     chksum:=(fe[d] shl 2) xor chksum;

	     for e:=1 to 26 do begin

	      chksum:=(fe[e]*5) xor chksum;

	      for f:=1 to 26 do begin

	       chksum:=(fe[f]*6) xor chksum;

	       for g:=1 to 26 do begin

	        chksum:=(fe[g]*7) xor chksum;

	        for h:=1 to 26 do begin

	         chksum:=(fe[h] shl 3) xor chksum;

	         if (chksum=$8a) then ChkIfRightPwd;

	         chksum:=(fe[h] shl 3) xor chksum;

	        end;

	        chksum:=(fe[g]*7) xor chksum;

	       end;

	       chksum:=(fe[f]*6) xor chksum;

	      end;

	      chksum:=(fe[e]*5) xor chksum;

	     end;

	     chksum:=(fe[d] shl 2) xor chksum;

	    end;

	    chksum:=(fe[c]*3) xor chksum;

	   end;

	   chksum:=(fe[b] shl 1) xor chksum;

	  end;

	  chksum:=fe[a] xor chksum;

	 end;</XMP>

 Note: fe[1..26] contains 'a'..'z'<BR>

 <BR>

 It looks complicated, but is really fast. But there are still several

thousand "right" passwords.<BR>

 A serious weakness is that Steganos hides and <FONT color="blue">encrypts</FONT> the 

 filename (+00h) of the text. 

Thus, I wrote a procedure which ckecks if the first part of the decrypted 

text is a filename (very similar to Jean Flinn's approach). 

My whole program could check all possibilities in about 80 hours (but i 

guessed the first letter was 's' for something like 'stego'... it took not more 

than two hours :-)

<BR>

 <HR>

 Here are my procedures for Steganos in Pascal:<BR>

 <XMP>

	procedure makeCodeTable (passw: string;var codetable: array of byte);

	var i,old,temp: byte;

	    ba: array [0..255] of byte;

	begin

	 for i:=0 to 255 do codetable[i]:=i;

	 for i:=0 to 255 do begin

	  ba[i]:=ord (passw[1+(i mod length(passw))]);

	 end;

	 old:=0;

	 for i:=0 to 255 do begin

	  old:=(codetable[i]+ba[i]+old) and 255;

	  temp:=codetable[i];                           

	  codetable[i]:=codetable[old];               

	  codetable[old]:=temp;

	 end;

	end;

 </XMP>

 <FONT size="+1">

  Notes

 </FONT>

 <UL compact>

 <LI>passw is the password...</LI>

 <LI>codetable[0..255] is used for decryption later on</LI>

 <LI>the whole procedure is located at :00407090

 </UL>  

 <HR>

 <XMP>{

 	function decode (b:byte; var codetable:array of byte;var count:byte;var co:byte;

 			 var old: byte):byte;

	var temp: byte;

	begin

	 inc (count);

	 old:=codetable[count]+old;

	 temp:=codetable[count];

	 codetable[count]:=codetable[old];

	 codetable[old]:=temp;

	 temp:=codetable[count]+temp;

	 temp:=codetable[temp];

	 co:=co+$0d;

	 b:=b xor temp xor co;

	 decode:=b;

	end;

 </XMP> 

 <FONT size="+1">

  Notes

 </FONT>

 <UL compact>

 <LI>b is the byte to decrypt</LI>

 <LI>codetable[0..255] (see above)</LI>

 <LI>count is a counter (starts at 0)</LI>

 <LI>co is a constant (starts at 28h)</LI>

 <LI>old starts at 0

 <LI>the whole procedure is located at :00406fa0

 </UL>  

</PRE>

<BR><BR>



<!-- FINAL NOTES STARTS HERE -->

<TABLE CELLPADDING="1" CELLSPACING="2" BORDER="1" HEIGHT="45" 

 WIDTH= "100%">

<TR><TD bgcolor="#C6E7C6"><CENTER><FONT size=+2><FONT color=blue>Final

Notes</FONT>

</FONT></CENTER></TD></TR></TABLE>

<PRE>

 This is only the first step to decrypt steganography. It helps a little

 bit, but is far from being good. It makes brute force attacks faster, 

 but if someone uses numbers, lower and upper case characters, a brute 

 force attack is still too slow.<BR>

 Note for all steganography authors: Don't encrypt additional information

 such as a filename. This helps us a lot...

<!-- PASTE HERE YOUR FINAL NOTES (if any) -->

</PRE>

<BR><BR>



<!-- OB DUH STARTS HERE -->

<TABLE CELLPADDING="1" CELLSPACING="2" BORDER="1" HEIGHT="45" 

 WIDTH= "100%">

<TR><TD bgcolor="#C6E7C6"><CENTER><FONT size=+2><FONT color=blue>Ob

Duh</FONT></FONT>

</CENTER></TD></TR></TABLE>

 <CENTER>

   <I>

    Hey, Ob duh does not apply: Steganos Decryptor is freeware :-) 

    If you just want to strip files out of images, you don't have to 

    pay a penny.

   </I>

</CENTER>



<!-- WAY OUT STARTS HERE -->

<HR>

<CENTER><I>You are deep inside fravia's page of reverse engineering,  

choose your way out:</I></CENTER>

<BR><CENTER>

<!-- EITHER A NICE GIF LIKE THIS -->





<A href="sestegotgo.htm" tppabs="http://www.anticrack.de/fravia/sestegotgo.htm"><IMG SRC="noanon.gif" tppabs="http://www.anticrack.de/fravia/noanon.gif" 

ALT="stegano" ALIGN=CENTER WIDTH=114 HEIGHT=43 BORDER=0 VSPACE==

0 HSPACE=0></A>

<BR>

<FONT color=gray>Back to stego.htm</FONT>



<BR><BR>

<IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 

 

BORDER=0 VSPACE=0 HSPACE=0><A HREF="index.html" tppabs="http://www.anticrack.de/fravia/index.html">homepage</A>

<IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 

 

BORDER=0 VSPACE=0 HSPACE=0><A HREF="links.htm" tppabs="http://www.anticrack.de/fravia/links.htm">links</A> 

<IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 

 

BORDER=0 VSPACE=0 HSPACE=0><A HREF="searengi.htm" tppabs="http://www.anticrack.de/fravia/searengi.htm">search_forms</A>



<IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 

 

BORDER=0 VSPACE=0 HSPACE=0><A HREF="orc.htm" tppabs="http://www.anticrack.de/fravia/orc.htm">+ORC</A>

<IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 

 

BORDER=0 VSPACE=0 HSPACE=0><A HREF="student.htm" tppabs="http://www.anticrack.de/fravia/student.htm">students' essays</A>

<IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 

 

BORDER=0 VSPACE=0 HSPACE=0><A HREF="academy.htm" tppabs="http://www.anticrack.de/fravia/academy.htm">academy database</A>

<BR>

<IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 

 

BORDER=0 VSPACE=0 HSPACE=0><A HREF="realicra.htm" tppabs="http://www.anticrack.de/fravia/realicra.htm">reality 

 cracking</A>

<IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 

 

BORDER=0 VSPACE=0 HSPACE=0><A HREF="howtosea.htm" tppabs="http://www.anticrack.de/fravia/howtosea.htm">how to search</A>

<IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 

 

BORDER=0 VSPACE=0 HSPACE=0><A HREF="javascri.htm" tppabs="http://www.anticrack.de/fravia/javascri.htm">javascript 

 wars</A>

<BR>

<IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 

 

BORDER=0 VSPACE=0 HSPACE=0><A HREF="tools.htm" tppabs="http://www.anticrack.de/fravia/tools.htm">tools</A>

<IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 

 

BORDER=0 VSPACE=0 HSPACE=0><A HREF="noanon.htm" tppabs="http://www.anticrack.de/fravia/noanon.htm">anonymity 

 academy</A> 

<IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 

 

BORDER=0 VSPACE=0 HSPACE=0><A HREF="cocktail.htm" tppabs="http://www.anticrack.de/fravia/cocktail.htm">cocktails</A>

<IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 

 

BORDER=0 VSPACE=0 HSPACE=0><A HREF="ideale.htm" tppabs="http://www.anticrack.de/fravia/ideale.htm">antismut

CGI-scripts</A>



<IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 

 

BORDER=0 VSPACE=0 HSPACE=0><A HREF="info.htm" tppabs="http://www.anticrack.de/fravia/info.htm">mail_fravia+</A>

<BR>

<IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 

 

BORDER=0 VSPACE=0 HSPACE=0><A HREF="legal.htm" tppabs="http://www.anticrack.de/fravia/legal.htm">Is reverse engineering

legal?</A>

</CENTER>

<HR>

<!-- THAT'S ALL, THANKS A LOT this will allow automated retrieval -->

</BODY>

<BR>

</HTML>

