<HTML>

<HEAD>

<!--  formamus.htm version 02 February 1998 

      INSTRUCTIONS FOR SUBMITTING: DO NOT USE HTML EDITORS!

      SEARCH THIS TEXT FOR THE STRING "Your_" 

      AND REPLACE WITH WHATEVER YOU WANT TO PUBLISH! 

      THANKS A LOT: this will allow automated retrieval -->

<TITLE>laste_09.htm: isDcc: An installshield Decompiler</TITLE>

</HEAD>



<BODY BGCOLOR=#C0C0C0 TEXT=#001010 VLINK=#405040>

<TABLE CELLPADDING="1" CELLSPACING="2" BORDER="1" WIDTH= "100%

HEIGHT=" 22">

<TR><td></td>

<td>

<!-- Choose  a TITLE probably wont be changed -->

<center><FONT SIZE="+2">isDcc</fonT><br>

        <FONT SIZE="+1">An installshield Decompiler</fonT>

</center>

</td>



<td>

<!-- Choose  a PROJECT GIF, leave this if unsure -->

<center><a href="advanced.htm" tppabs="http://www.anticrack.de/fravia/advanced.htm"><IMG SRC="xtranio.gif" tppabs="http://www.anticrack.de/fravia/xtranio.gif"

ALT="advanced" 

ALIGN=CENTER WIDTH=114 HEIGHT=43 BORDER=0 VSPACE=0 

HSPACE=0></a>

<br>

<font color=gray>Advanced reversing</FonT>

</center></td></tr>

<tR>

<td bgcolor="#FFFFEA"><center>

<FONT COLOR="890000">

<!-- CHOOSE A DATE (will probably be changed) -->

30 October 1998

</FONT></center>

</td>

<td bgcolor="#FFFFEA"><center>by <font size=+3>

<!-- CHOOSE A HANDLE (wont be changed) -->

adq

</fonT></center>

</td>

<td VALIGN="center" bgcolor="#FFFFEA">

<!--

<a href="hcu98_3.htm" tppabs="http://www.anticrack.de/fravia/hcu98_3.htm"><IMG SRC="hcu1.gif" tppabs="http://www.anticrack.de/fravia/hcu1.gif" ALT="+cracker" ALIGN=BOTTOM 

WIDTH=114 HEIGHT=43 BORDER=0 VSPACE=0 HSPACE=0></a>

-->

</td>

</tr>

<TR><td><center><a href="index.html" tppabs="http://www.anticrack.de/fravia/index.html"><IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif"

ALIGN="BOTTOM" 

BORDER="0" VSPACE="0" HSPACE="0" width="13" height="13"></a></center></td>

<TD BGCOLOR="898030"><center>Courtesy of Fravia's page of 

reverse engineering</center> 

</center></TD>

<td BGCOLOR="898030">

<center>

<!-- Your truly+ will edit only if really necessary -->

slightly edited<br>

by fravia+</center></td>

</TR>

<!-- this is for the

data.....fra_00xx....yymmdd....handle..beg+int...not ass... -->

<tr><td><font

color="#C4C0CF">fra_00xx<bR>981030<br>adq<br>0010<br>AD<br>0T<br></fonT></td><td><i><center>

<!-- Your truly+ comments -->

Well, well, well... a "real" reversing essay! Andrew shows us all here what's like when 

you seriously work on an 'our tools' project. You'll be able to download isDcc either 

<a href="javascript:if(confirm('http://fravia.org/zipped/isDcc10.zip  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://fravia.org/zipped/isDcc10.zip'" tppabs="http://fravia.org/zipped/isDcc10.zip">here</a> or on 

<a href="javascript:if(confirm('http://www.tardis.ed.ac.uk/~adq  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.tardis.ed.ac.uk/~adq'" tppabs="http://www.tardis.ed.ac.uk/~adq">Andrew's main page</a>. Installshield decompiling 

is developing into a full-fledged science, after NaTzGUL's 'bahnbrechenden' 

<a href="javascript:if(confirm('http://www.anticrack.de/fravia/natz-1.htm  \n\nThis file was not retrieved by Teleport Pro, because the server reports that this file cannot be found.  \n\nDo you want to open it from the server?'))window.location='http://www.anticrack.de/fravia/natz-1.htm'" tppabs="http://www.anticrack.de/fravia/natz-1.htm">InstallSHIELD Script Cracking</a>. That's GOOD. In a sofware world 

where more and more processes are hidden or concealed from the users, the fact that 

(some) users are re-gaining control is a very positive development. Transparency and 

free knowledge are  

our (very strong) weapons, dark hyding and hideous concealing are the (very strong) 

weapons of our enemies... There is a crack, a crack in

everything 

That's how the light gets in... how true!

</i></center></td>

<td><center><a href="ourtools.htm" tppabs="http://www.anticrack.de/fravia/ourtools.htm"><IMG SRC="ourtools.gif" tppabs="http://www.anticrack.de/fravia/ourtools.gif"

ALT="ourtools" 

ALIGN=CENTER WIDTH=114 HEIGHT=43 BORDER=0 VSPACE=0 

HSPACE=0></a>

<br>

<font color=gray>Our tools</FonT>

</center></td>

</tr>

<TR><td></td>

<!-- Leonard Coehn's old song, because we are poets, not only crackers

-->

<TD BGCOLOR="898030"><center></i><b>There is a crack, a crack in

everything 

That's how the light gets in</b></center>

<!-- Leonard Coehn's old song, because we are poets, not only crackers

-->

</center></TD><td></td>

</TR>

<TR>

<td VALIGN= "MIDDLE" bgcolor="#C6E7C6"><font color=blue><center>

Rating</FONT></FONT></center>

</TD>

<td VALIGN = "MIDDLE" bgcolor="#C6E7C6"><font color=blue><center>

<!-- CHOOSE A RATING (may be changed) -->

( )<B>Beginner</B> ( )<B>Intermediate</B> (X)<B>Advanced</B> (

)<B>Expert</B></FONT>

</center></td>

<td></td>

</tr>

</table>

<!-- END HEAD  -->

<bR>

<!-- CORPUS  -->



<!-- CHOOSE A COMMENT (may be changed)  -->

This is an overview of the main structure of isDcc. It describes how

the

main algorithms work, so you should have a good understanding of

computer

algorithm design.



<hR>

<center>

   <FONT SIZE="+2">

<!-- CHOOSE A TITLE (wont probably be changed) -->

isDcc

   </FONT><BR>

   <FONT SIZE="+2">

<!-- CHOOSE A SUBTITLE (wont proabbly be changed) -->

An installshield decompiler

   </FONT><BR>

   <FONT COLOR="0B7FC1">

<!-- REPEAT YOUR CHOSEN HANDLE HERE -->Written by 

adq

   </FONT>

</center><br><br>



<!-- INTRO STARTS HERE -->

<TABLE CELLPADDING="1" CELLSPACING="2" BORDER="1" WIDTH= "100%"

HEIGHT="22" >

<tr><td bgcolor="#C6E7C6"><center><font size=+2><font

color=blue>Introduction</fonT>

</fonT></center></td></tr></table>

Like wisdec, isDcc allows decompilation of a compiled installshield

script (.ins file) into source code (.rul file). Due to the nature of

the original installshield compiler, the "original" source code cannot

be recovered exactly, but compilable scripts are produced, providing

the same version of the installshield compiler is used to recompile

them.

<br><br>



<!-- TOOLS STARTS HERE -->

<TABLE CELLPADDING="1" CELLSPACING="2" BORDER="1" WIDTH= "100%"

HEIGHT="22" >

<tr><td bgcolor="#C6E7C6"><center><font size=+2><font color=blue>Tools

required</fonT>

</fonT></center></td></tr></table>

GNU Emacs, and MS Visual C++ would be useful if you intend to

recompile the 

thing.

<br><br>



<!-- TARGET URL STARTS HERE -->

<TABLE CELLPADDING="1" CELLSPACING="2" BORDER="1" WIDTH= "100%"

HEIGHT="22" >

<tr><td bgcolor="#C6E7C6"><center><font size=+2><font

color=blue>Target's URL/FTP</fonT>

</fonT></center></td></tr></table>

<!-- DON'T FORGET TO PASTE HERE THE URL/FTP OF YOUR TARGET(S) -->

<a href="javascript:if(confirm('http://www.tardis.ed.ac.uk/~adq  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.tardis.ed.ac.uk/~adq'" tppabs="http://www.tardis.ed.ac.uk/~adq">http://www.tardis.ed.ac.uk/~adq</a>

<a href="javascript:if(confirm('http://www.installshield.com/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.installshield.com/'" tppabs="http://www.installshield.com/">http://www.installshield.com/</a>

<br><br>



<!-- PROGRAM HISTORY STARTS HERE -->

<TABLE CELLPADDING="1" CELLSPACING="2" BORDER="1" WIDTH= "100%"

HEIGHT="22" >

<tr><td bgcolor="#C6E7C6"><center><font size=+2><font

color=blue>Program History</fonT>

</fonT></center></td></tr></table>

<!-- PASTE HERE YOUR TARGET'S HISTORY (if any) -->

v1.00 - Initial release<BR>

v1.01 - Couple of bugs fixed

<br><br>



<!-- REAL ESSAY  STARTS HERE -->

<TABLE CELLPADDING="1" CELLSPACING="2" BORDER="1" WIDTH= "100%"

HEIGHT="22" >

<tr><td bgcolor="#C6E7C6"><center><font size=+2><font

color=blue>Essay</fonT></fonT>

</center></td></tr></table>

isDcc was written with the help of wisdec v1.0, by NaTzGUL/SiraX, see 

NaTzGUL's 

<a href="javascript:if(confirm('http://www.anticrack.de/fravia/natz-1.htm  \n\nThis file was not retrieved by Teleport Pro, because the server reports that this file cannot be found.  \n\nDo you want to open it from the server?'))window.location='http://www.anticrack.de/fravia/natz-1.htm'" tppabs="http://www.anticrack.de/fravia/natz-1.htm">InstallSHIELD Script Cracking</a>. 

Wisdec is a

masterful piece of work, which obviously involved reverse engineering

the

installshield compiler to discover the format of the compiled script

files.<P>



I used wisdec to explore the compiled files, changing scripts, 

recompiling them, and observing the differences reported by wisdec. It

took

a couple of evenings to divine the format of an installshield 2 file

in this

manner.<P>



Here, I shall describe a couple of things about installshield files

which

are essential to understand the following:<P>

<UL>

<LI> <B>High level code structures</B>: Some higher level code

structures 

(e.g. FOR, WHILE) are transformed by the installshield compiler into

lower 

level sequences, often involving lots of gotos.



<LI> <B>Functions</B>: In the compiled files, functions are indicated

by

a special "function start" opcode, and a "function end" opcode.



<LI> <B>Function prototypes</B>: In the header, there is a set of

function

prototypes describing each of the functions present in the file,

indicating

their parameter types, what type of function it is (e.g. a DLL

function, or a 

script function), and it's name if it is a DLL import function.

</UL>



Installshield scripts consist of a <B>header</B>, describing global

features, 

for example function prototypes. The actual body of the script

consists of a 

set of opcodes, describing the series of operations to take. Each

opcode has 

some associated information after it (e.g. for a function call, you

will find 

the parameters for the function call immediately after the opcode).<P>



The first thing written was a parser for the header. This code is

fairly 

simple: it reads values in from the file, processes them, and stores

them

in appropriate data structures.<P>



However, the main script decoder is rather more complex. It involves

three

passes through the script code:<BR>



The first pass actually reads the raw opcodes from the file, and

transforms

them into an internal structure describing the code. This is 

implemented as a massive table-driven algorithm. The table is keyed by

opcode.

Each entry contains a function pointer to a specific parser function,

along

with some extra information, such as the parameter count. For an

"installshield

system function", a generic decoder function is available, since they

all 

have the same format. The main loop of this stage reads in an opcode,

looks it 

up in the table, and executes the associated function there. This

function 

takes care of the specific processing for that opcode, before

returning to the 

main loop. This continues until the end of the file is encountered.<P>



The second pass works out function/prototype pairings, and fixes local

variable

counts. Because of the way a compiled script works, it is only

possible to

work out which function prototype is associated with which function

body after

a call has been made to that function. This stage goes through the

interpreted

code, looking for function calls, and associating function bodies with



prototypes when it finds one. It also works out which variables in the



function are locals, and which are parameters, since, again, this is

not 

possible until it is discovered which function prototype pairs with

which 

function. Note that it doesn't actually alter the code in the function

to

reflect this; it just works out <b>which</b> variables are which. 

<FONT SIZE="-1"> Note that this means any

function which is not called cannot be matched to it's prototype, and

therefore has to be discarded.</FONT><P>



The third, and final pass, goes through the code again, this time

transforming

the code in function bodies to reflect whether a local or a parameter

variable

is being accessed, to simplify any later processing.<P>



Now, we have a huge memory structure, representing the compiled file.

The next

step will be to optimise the code sequences, and recover more of the

original

structure, for example FOR loops, and IF/ELSE sequences. However, this

part

is still under development.<P>



Finally, the memory structure is decoded into a .RUL file and output

it.<P>

<HR>

Installshield 5 brings a few changes. Some functions have had extra 

parameters added, necessitating special decoder functions for some 

installshield system functions. Also, user defined datatypes are

possible, 

which changed the header slightly.<P>



It has also had a large number of functions added to it. To find

these, I

examined the handy installshield documentation. (I even found some

hidden features - see below)<P>



Several functions have been removed from installshield 5, notably the

CompressGet family. Installshield have completely revamped their

method

of installation, and have unfortunately decided to completely

unsupport the

previous method.<P>



All this means that you cannot recompile an installshield 3 script

with the

installshield 5 compiler, and vice versa.<P>

<br><br>



<!-- FINAL NOTES STARTS HERE -->

<TABLE CELLPADDING="1" CELLSPACING="2" BORDER="1" WIDTH= "100%"

HEIGHT="22" >

<tr><td bgcolor="#C6E7C6"><center><font size=+2><font color=blue>Final

Notes</fonT>

</fonT></center></td></tr></table>

One of the main problems with the decompiler at the moment is that it

cannot recover higher level code structures (e.g. FOR loops) from the

sequence

of GOTOs they are transformed into by the compiler. This means that if

one of

these structures is used in a function, we will end up with GOTOs in a



function, which is <B>not</B> allowed  by the installshield script

compiler 

version 3. Hoever, the compiler for installshield version 5 does not

check 

for this, so installshield 5 scripts are recompilable as they are at

the 

moment.<P>



Due to the fact that the code automatically discards unused functions,



installshield scripts tend to halve in size when recompiled. For

example,

even if you only use one of the SdDialog functions, the compiler

includes 

<em>all</em> of them in the compiled file.<P>



Incidentally, I discovered a hidden feature of installshield scripts:

the

call statement. It seems you can have subroutines based on call/return

as

well as functions. I saw one script which used this feature, which 

prompted me to investigate further. I wonder why they don't tell

anyone about

it, since it is still in the compiler.<P>



Currently I am developing code the recover higher level code

structures, 

so that installshield 3 scripts should soon be recompilable too.<P>



<br><br>



<!-- OB DUH STARTS HERE -->

<TABLE CELLPADDING="1" CELLSPACING="2" BORDER="1" WIDTH= "100%"

HEIGHT="22" >

<tr><td bgcolor="#C6E7C6"><center><font size=+2><font color=blue>Ob

Duh</fonT></fonT>

</center></td></tr></table>

 <center>

   <i>Doesn't apply: we are reversing on our own and creating our own tools</i>

</center>



<!-- WAY OUT STARTS HERE -->

<hr>

<center><i>You are deep inside fravia's page of reverse engineering,  

choose your way out:</i></center>

<br><center>



<a href="advanced.htm" tppabs="http://www.anticrack.de/fravia/advanced.htm"><IMG SRC="xtranio.gif" tppabs="http://www.anticrack.de/fravia/xtranio.gif" 

ALT="advanced" ALIGN=CENTER WIDTH=114 HEIGHT=43 BORDER=0 VSPACE=0

HSPACE=0></a>

<br>

<font color=gray>Back to Advanced reversing</FonT>

<br><bR>

-->



<!-- OR JUST A LINK LIKE THIS -->



<!--

<IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 

BORDER=0 VSPACE=0 HSPACE=0><A HREF="project1.htm" tppabs="http://www.anticrack.de/fravia/project1.htm">Back to

Your_chosen_project</A> 

<hr width=33%>

-->



<IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 

BORDER=0 VSPACE=0 HSPACE=0><A HREF="index.html" tppabs="http://www.anticrack.de/fravia/index.html">homepage</A>

<IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 

BORDER=0 VSPACE=0 HSPACE=0><A HREF="links.htm" tppabs="http://www.anticrack.de/fravia/links.htm">links</A> 

<IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 

BORDER=0 VSPACE=0 HSPACE=0><A HREF="searengi.htm" tppabs="http://www.anticrack.de/fravia/searengi.htm">search_forms</A>



<IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 

BORDER=0 VSPACE=0 HSPACE=0><A HREF="orc.htm" tppabs="http://www.anticrack.de/fravia/orc.htm">+ORC</A>

<IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 

BORDER=0 VSPACE=0 HSPACE=0><A HREF="student.htm" tppabs="http://www.anticrack.de/fravia/student.htm">students' essays</A>

<IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 

BORDER=0 VSPACE=0 HSPACE=0><A HREF="academy.htm" tppabs="http://www.anticrack.de/fravia/academy.htm">academy database</A>

<br>

<IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 

BORDER=0 VSPACE=0 HSPACE=0><A HREF="realicra.htm" tppabs="http://www.anticrack.de/fravia/realicra.htm">reality cracking</A>

<IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 

BORDER=0 VSPACE=0 HSPACE=0><A HREF="howtosea.htm" tppabs="http://www.anticrack.de/fravia/howtosea.htm">how to search</A>

<IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 

BORDER=0 VSPACE=0 HSPACE=0><A HREF="javascri.htm" tppabs="http://www.anticrack.de/fravia/javascri.htm">javascript wars</A>

<br>

<IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 

BORDER=0 VSPACE=0 HSPACE=0><A HREF="tools.htm" tppabs="http://www.anticrack.de/fravia/tools.htm">tools</A>

<IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 

BORDER=0 VSPACE=0 HSPACE=0><A HREF="noanon.htm" tppabs="http://www.anticrack.de/fravia/noanon.htm">anonymity academy</A> 

<IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 

BORDER=0 VSPACE=0 HSPACE=0><A HREF="cocktail.htm" tppabs="http://www.anticrack.de/fravia/cocktail.htm">cocktails</A>

<IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 

BORDER=0 VSPACE=0 HSPACE=0><A

HREF="javascript:if(confirm('http://www.anticrack.de/fravia/-a href=  \n\nThis file was not retrieved by Teleport Pro, because the server reports that this file cannot be found.  \n\nDo you want to open it from the server?'))window.location='http://www.anticrack.de/fravia/-a href='" tppabs="http://www.anticrack.de/fravia/-a href=" target=_blank http://fravia.org/ideale.htm">http://fravia.org/ideale.htm</A>">antismut CGI-scripts</A>



<IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 

BORDER=0 VSPACE=0 HSPACE=0><A HREF="info.htm" tppabs="http://www.anticrack.de/fravia/info.htm">mail_fravia+</A>

<BR>

<IMG SRC="bulletr.gif" tppabs="http://www.anticrack.de/fravia/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 

BORDER=0 VSPACE=0 HSPACE=0><A HREF="legal.htm" tppabs="http://www.anticrack.de/fravia/legal.htm">Is reverse engineering

legal?</A>

</CENTER>

<HR>

<!-- THAT'S ALL, THANKS A LOT this will allow automated retrieval -->

</BODY>

</HTML>





